

#include "hmac_cali_mgmt.h"
#include "plat_cali.h"
#include "plat_pm_wlan.h"
#include "securec.h"
#include "hmac_cali_arr_init.h"
#include "hmac_cali_mgmt_debug.h"
#include "wlan_chip_i.h"
#include "host_hal_device.h"
#include "hmac_config.h"

#undef  THIS_FILE_ID
#define THIS_FILE_ID OAM_FILE_ID_HMAC_CALI_MGMT_C
static wlan_cali_chn_stru g_hmac_chn_cali_data;
static wlan_cali_rf_20m_para_stru g_hmac_scan_all_ch_cali_data[HAL_HOST_MAX_RF_NUM];
static wlan_cali_data_20m_common_para_stru g_hmac_20m_cali_common_data;
oal_completion g_wlan_cali_completed;
oal_completion *hmac_get_wlan_cali_completed_addr(void)
{
    return &g_wlan_cali_completed;
}
int8_t g_wait_wlan_power_on_cali = OAL_TRUE;
int8_t hmac_get_wlan_first_power_on_cali_flag(void)
{
    return g_wait_wlan_power_on_cali;
}
void hmac_set_wlan_first_powon_mark(oal_bool_enum_uint8 status)
{
    g_wait_wlan_power_on_cali = (int8_t)status;
}

/*  大小:16bit * 15 * 32 = 960 Byte */
int16_t g_as_rxiq_h_comp_80m[HI1103_CALI_RXIQ_LS_FILTER_TAP_NUM_80M][HI1103_CALI_RXIQ_LS_FILTER_FEQ_NUM_80M] = {
    { -400, 1138, -1703, 2009, -2009, 1703, -1138, 400, 400, -1138, 1703, -2009, 2009, -1703, 1138, -400,
      -722, 417, 148, -887, 1686, -2424, 2989, -3295, 3295, -2989, 2424, -1686, 887, -148, -417, 722, },
    { 784, -1892, 1892, -784, -784, 1892, -1892, 784, 784, -1892, 1892, -784, -784, 1892, -1892, 784, 1892, -784,
      -784, 1892, -1892, 784, 784, -1892, 1892, -784, -784, 1892, -1892, 784, 784, -1892, },
    { -1138, 2009, -400, -1703, 1703, 400, -2009, 1138, 1138, -2009, 400, 1703, -1703, -400, 2009, -1138, -2155,
      52, 1557, -686, -1589, 2460, -851, -1251, 1251, 851, -2460, 1589, 686, -1557, -52, 2155, },
    { 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448,
      1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, },
    { -1703, 400, 2009, 1138, -1138, -2009, -400, 1703, 1703, -400, -2009, -1138, 1138, 2009, 400, -1703, -836,
      -2310, -98, 1401, 2005, -701, -1707, -1440, 1440, 1707, 701, -2005, -1401, 98, 2310, 836, },
    { 1892, 784, -784, -1892, -1892, -784, 784, 1892, 1892, 784, -784, -1892, -1892, -784, 784, 1892, 784, 1892,
      1892, 784, -784, -1892, -1892, -784, 784, 1892, 1892, 784, -784, -1892, -1892, -784, },
    { -2009, -1703, -1138, -400, 400, 1138, 1703, 2009, 2009, 1703, 1138, 400, -400, -1138, -1703, -2009, -655,
      -882, -1959, -1753, -2264, -1447, -1394, -144, 144, 1394, 1447, 2264, 1753, 1959, 882, 655, },
    { 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, },
    { -2009, -1703, -1138, -400, 400, 1138, 1703, 2009, 2009, 1703, 1138, 400, -400, -1138, -1703, -2009, 655,
      882, 1959, 1753, 2264, 1447, 1394, 144, -144, -1394, -1447, -2264, -1753, -1959, -882, -655, },
    { 1892, 784, -784, -1892, -1892, -784, 784, 1892, 1892, 784, -784, -1892, -1892, -784, 784, 1892, -784, -1892,
      -1892, -784, 784, 1892, 1892, 784, -784, -1892, -1892, -784, 784, 1892, 1892, 784, },
    { -1703, 400, 2009, 1138, -1138, -2009, -400, 1703, 1703, -400, -2009, -1138, 1138, 2009, 400, -1703, 836,
      2310, 98, -1401, -2005, 701, 1707, 1440, -1440, -1707, -701, 2005, 1401, -98, -2310, -836, },
    { 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448,
      -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, -1448, -1448, 1448, 1448, },
    { -1138, 2009, -400, -1703, 1703, 400, -2009, 1138, 1138, -2009, 400, 1703, -1703, -400, 2009, -1138, 2155,
      -52, -1557, 686, 1589, -2460, 851, 1251, -1251, -851, 2460, -1589, -686, 1557, 52, -2155, },
    { 784, -1892, 1892, -784, -784, 1892, -1892, 784, 784, -1892, 1892, -784, -784, 1892, -1892, 784, -1892, 784,
      784, -1892, 1892, -784, -784, 1892, -1892, 784, 784, -1892, 1892, -784, -784, 1892, },
    { -400, 1138, -1703, 2009, -2009, 1703, -1138, 400, 400, -1138, 1703, -2009, 2009, -1703, 1138, -400, 722,
      -417, -148, 887, -1686, 2424, -2989, 3295, -3295, 2989, -2424, 1686, -887, 148, 417, -722, },
};

/*  大小:16bit * 17 * 128 = 4352 Byte */
int16_t g_as_rxiq_h_comp_320m[HI1103_CALI_RXIQ_LS_FILTER_TAP_NUM_320M][HI1103_RXIQ_LSFIR_FEQ_NUM_320M] = {
    { 147, 75, -33, -125, -156, -112, -16, 86, 147, 141, 76, -15, -91, -124, -108, -63, -1416, 1448, 1684, 213,
      -1328, -1694, -716, 780, 1671, 1335, 48, -1262, -1678, -922, 472, 1537, 1537, 472, -922, -1678, -1262, 48,
      1335, 1671, 780, -716, -1694, -1328, 213, 1684, 1448, -1416, -63, -108, -124, -91, -15, 76, 141, 147, 86,
      -16, -112, -156, -125, -33, 75, 147, 55, 139, 156, 99, -5, -106, -159, -140, -59, 46, 133, 171, 155, 102,
      42, 0, -1295, -510, 846, 1413, 781, -475, -1368, -1245, -217, 966, 1468, 946, -231, -1249, -1411, -609, 609,
      1411, 1249, 231, -946, -1468, -966, 217, 1245, 1368, 475, -781, -1413, -846, 510, 1295, 0, -42, -102, -155,
      -171, -133, -46, 59, 140, 159, 106, 5, -99, -156, -139, -55, },
    { -354, -201, 38, 256, 361, 312, 137, -84, -259, -324, -270, -138, 6, 103, 129, 94, 3390, -1378, -2958, -1669,
      657, 2102, 1826, 334, -1135, -1570, -840, 351, 1067, 841, -34, -787, -787, -34, 841, 1067, 351, -840, -1570,
      -1135, 334, 1826, 2102, 657, -1669, -2958, -1378, 3390, 94, 129, 103, 6, -138, -270, -324, -259, -84, 137,
      312, 361, 256, 38, -201, -354, -133, -339, -398, -284, -51, 199, 360, 369, 230, 8, -208, -341, -362, -287,
      -168, -59, 510, 1996, 502, -1369, -1900, -918, 592, 1462, 1188, 158, -775, -969, -421, 320, 632, 309, -309,
      -632, -320, 421, 969, 775, -158, -1188, -1462, -592, 918, 1900, 1369, -502, -1996, -510, 59, 168, 287, 362,
      341, 208, -8, -230, -369, -360, -199, 51, 284, 398, 339, 133, },
    { 521, 331, 25, -281, -475, -494, -345, -94, 164, 344, 405, 356, 242, 118, 27, -16, -1977, -560, 724, 1011,
      511, -75, -240, 5, 272, 196, -243, -709, -791, -335, 412, 972, 972, 412, -335, -791, -709, -243, 196, 272,
      5, -240, -75, 511, 1011, 724, -560, -1977, -16, 27, 118, 242, 356, 405, 344, 164, -94, -345, -494, -475,
      -281, 25, 331, 521, 179, 467, 575, 467, 193, -135, -390, -488, -411, -209, 29, 215, 300, 281, 196, 95, 1913,
      -1595, -1753, -454, 610, 760, 291, -124, -85, 277, 514, 293, -307, -857, -918, -392, 392, 918, 857, 307,
      -293, -514, -277, 85, 124, -291, -760, -610, 454, 1753, 1595, -1913, -95, -196, -281, -300, -215, -29, 209,
      411, 488, 390, 135, -193, -467, -575, -467, -179, },
    { -563, -411, -152, 140, 382, 512, 502, 369, 160, -60, -234, -327, -333, -272, -178, -86, -1992, 1285, 1812,
      904, -155, -630, -465, -46, 181, 19, -387, -697, -627, -142, 515, 976, 976, 515, -142, -627, -697, -387, 19,
      181, -46, -465, -630, -155, 904, 1812, 1285, -1992, -86, -178, -272, -333, -327, -234, -60, 160, 369, 502,
      512, 382, 140, -152, -411, -563, -153, -413, -554, -540, -385, -143, 112, 311, 412, 411, 332, 216, 104, 23,
      -19, -28, -1878, -552, 337, 594, 451, 245, 175, 236, 294, 223, -6, -315, -567, -646, -506, -191, 191, 506,
      646, 567, 315, 6, -223, -294, -236, -175, -245, -451, -594, -337, 552, 1878, 28, 19, -23, -104, -216, -332,
      -411, -412, -311, -112, 143, 385, 540, 554, 413, 153, },
    { 516, 437, 289, 92, -121, -314, -450, -503, -468, -360, -214, -71, 36, 89, 92, 63, 2690, 40, -916, -561, 182,
      507, 161, -546, -1067, -1029, -465, 250, 688, 656, 306, -9, -9, 306, 656, 688, 250, -465, -1029, -1067,
      -546, 161, 507, 182, -561, -916, 40, 2690, 63, 92, 89, 36, -71, -214, -360, -468, -503, -450, -314, -121, 92,
      289, 437, 516, 88, 257, 401, 498, 524, 460, 309, 95, -138, -336, -458, -483, -422, -307, -180, -76, -1233,
      1237, 1209, 371, -128, -3, 393, 558, 269, -303, -777, -867, -579, -165, 86, 70, -70, -86, 165, 579, 867, 777,
      303, -269, -558, -393, 3, 128, -371, -1209, -1237, 1233, 76, 180, 307, 422, 483, 458, 336, 138, -95, -309,
      -460, -524, -498, -401, -257, -88, },
    { -472, -447, -390, -296, -163, 1, 178, 341, 463, 524, 518, 453, 351, 236, 133, 56, 1073, -821, -1026, -566,
      -163, -105, -317, -552, -598, -393, -34, 310, 501, 506, 399, 301, 301, 399, 506, 501, 310, -34, -393, -598,
      -552, -317, -105, -163, -566, -1026, -821, 1073, 56, 133, 236, 351, 453, 518, 524, 463, 341, 178, 1, -163,
      -296, -390, -447, -472, -52, -162, -286, -415, -522, -576, -550, -442, -274, -85, 79, 184, 218, 193, 134, 71,
      2367, -2, -458, -16, 406, 381, -10, -440, -650, -604, -447, -346, -353, -387, -327, -130, 130, 327, 387, 353,
      346, 447, 604, 650, 440, 10, -381, -406, 16, 458, 2, -2367, -71, -134, -193, -218, -184, -79, 85, 274, 442,
      550, 576, 522, 415, 286, 162, 52, },
    { 483, 474, 454, 418, 360, 275, 164, 35, -100, -218, -300, -332, -312, -250, -168, -89, -2940, 188, 864, 158,
      -743, -1062, -666, 72, 632, 709, 372, -37, -163, 114, 613, 994, 994, 613, 114, -163, -37, 372, 709, 632, 72,
      -666, -1062, -743, 158, 864, 188, -2940, -89, -168, -250, -312, -332, -300, -218, -100, 35, 164, 275, 360,
      418, 454, 474, 483, 55, 159, 251, 326, 387, 438, 481, 512, 526, 511, 464, 386, 289, 189, 102, 40, 592, -640,
      -609, -237, -84, -255, -556, -735, -682, -473, -278, -221, -292, -370, -328, -132, 132, 328, 370, 292, 221,
      278, 473, 682, 735, 556, 255, 84, 237, 609, 640, -592, -40, -102, -189, -289, -386, -464, -511, -526, -512,
      -481, -438, -387, -326, -251, -159, -55, },
    { -522, -511, -493, -472, -451, -432, -413, -391, -360, -318, -265, -205, -145, -91, -48, -19, -340, 279, 336,
      202, 110, 141, 261, 391, 467, 474, 438, 407, 414, 461, 526, 570, 570, 526, 461, 414, 407, 438, 474, 467,
      391, 261, 141, 110, 202, 336, 279, -340, -19, -48, -91, -145, -205, -265, -318, -360, -391, -413, -432, -451,
      -472, -493, -511, -522, -47, -127, -176, -193, -194, -204, -244, -319, -412, -494, -533, -512, -432, -314,
      -191, -90, -2544, 208, 446, -304, -895, -900, -505, -127, -40, -215, -422, -449, -263, -11, 123, 70, -70,
      -123, 11, 263, 449, 422, 215, 40, 127, 505, 900, 895, 304, -446, -208, 2544, 90, 191, 314, 432, 512, 533,
      494, 412, 319, 244, 204, 194, 193, 176, 127, 47, },
    { 542, 529, 508, 487, 474, 477, 498, 532, 565, 582, 567, 513, 423, 310, 194, 97, 3005, -252, -829, -5, 967,
      1335, 1005, 368, -71, -32, 397, 874, 1058, 838, 388, 38, 38, 388, 838, 1058, 874, 397, -32, -71, 368, 1005,
      1335, 967, -5, -829, -252, 3005, 97, 194, 310, 423, 513, 567, 582, 565, 532, 498, 477, 474, 487, 508, 529,
      542, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, },
    { -522, -511, -493, -472, -451, -432, -413, -391, -360, -318, -265, -205, -145, -91, -48, -19, -340, 279, 336,
      202, 110, 141, 261, 391, 467, 474, 438, 407, 414, 461, 526, 570, 570, 526, 461, 414, 407, 438, 474, 467,
      391, 261, 141, 110, 202, 336, 279, -340, -19, -48, -91, -145, -205, -265, -318, -360, -391, -413, -432, -451,
      -472, -493, -511, -522, 47, 127, 176, 193, 194, 204, 244, 319, 412, 494, 533, 512, 432, 314, 191, 90, 2544,
      -208, -446, 304, 895, 900, 505, 127, 40, 215, 422, 449, 263, 11, -123, -70, 70, 123, -11, -263, -449, -422,
      -215, -40, -127, -505, -900, -895, -304, 446, 208, -2544, -90, -191, -314, -432, -512, -533, -494, -412,
      -319, -244, -204, -194, -193, -176, -127, -47, },
    { 483, 474, 454, 418, 360, 275, 164, 35, -100, -218, -300, -332, -312, -250, -168, -89, -2940, 188, 864, 158,
      -743, -1062, -666, 72, 632, 709, 372, -37, -163, 114, 613, 994, 994, 613, 114, -163, -37, 372, 709, 632, 72,
      -666, -1062, -743, 158, 864, 188, -2940, -89, -168, -250, -312, -332, -300, -218, -100, 35, 164, 275, 360,
      418, 454, 474, 483, -55, -159, -251, -326, -387, -438, -481, -512, -526, -511, -464, -386, -289, -189, -102,
      -40, -592, 640, 609, 237, 84, 255, 556, 735, 682, 473, 278, 221, 292, 370, 328, 132, -132, -328, -370, -292,
      -221, -278, -473, -682, -735, -556, -255, -84, -237, -609, -640, 592, 40, 102, 189, 289, 386, 464, 511, 526,
      512, 481, 438, 387, 326, 251, 159, 55, },
    { -472, -447, -390, -296, -163, 1, 178, 341, 463, 524, 518, 453, 351, 236, 133, 56, 1073, -821, -1026, -566,
      -163, -105, -317, -552, -598, -393, -34, 310, 501, 506, 399, 301, 301, 399, 506, 501, 310, -34, -393, -598,
      -552, -317, -105, -163, -566, -1026, -821, 1073, 56, 133, 236, 351, 453, 518, 524, 463, 341, 178, 1, -163,
      -296, -390, -447, -472, 52, 162, 286, 415, 522, 576, 550, 442, 274, 85, -79, -184, -218, -193, -134, -71,
      -2367, 2, 458, 16, -406, -381, 10, 440, 650, 604, 447, 346, 353, 387, 327, 130, -130, -327, -387, -353,
      -346, -447, -604, -650, -440, -10, 381, 406, -16, -458, -2, 2367, 71, 134, 193, 218, 184, 79, -85, -274,
      -442, -550, -576, -522, -415, -286, -162, -52, },
    { 516, 437, 289, 92, -121, -314, -450, -503, -468, -360, -214, -71, 36, 89, 92, 63, 2690, 40, -916, -561, 182,
      507, 161, -546, -1067, -1029, -465, 250, 688, 656, 306, -9, -9, 306, 656, 688, 250, -465, -1029, -1067,
      -546, 161, 507, 182, -561, -916, 40, 2690, 63, 92, 89, 36, -71, -214, -360, -468, -503, -450, -314, -121, 92,
      289, 437, 516, -88, -257, -401, -498, -524, -460, -309, -95, 138, 336, 458, 483, 422, 307, 180, 76, 1233,
      -1237, -1209, -371, 128, 3, -393, -558, -269, 303, 777, 867, 579, 165, -86, -70, 70, 86, -165, -579, -867,
      -777, -303, 269, 558, 393, -3, -128, 371, 1209, 1237, -1233, -76, -180, -307, -422, -483, -458, -336, -138,
      95, 309, 460, 524, 498, 401, 257, 88, },
    { -563, -411, -152, 140, 382, 512, 502, 369, 160, -60, -234, -327, -333, -272, -178, -86, -1992, 1285, 1812,
      904, -155, -630, -465, -46, 181, 19, -387, -697, -627, -142, 515, 976, 976, 515, -142, -627, -697, -387, 19,
      181, -46, -465, -630, -155, 904, 1812, 1285, -1992, -86, -178, -272, -333, -327, -234, -60, 160, 369, 502,
      512, 382, 140, -152, -411, -563, 153, 413, 554, 540, 385, 143, -112, -311, -412, -411, -332, -216, -104, -23,
      19, 28, 1878, 552, -337, -594, -451, -245, -175, -236, -294, -223, 6, 315, 567, 646, 506, 191, -191, -506,
      -646, -567, -315, -6, 223, 294, 236, 175, 245, 451, 594, 337, -552, -1878, -28, -19, 23, 104, 216, 332, 411,
      412, 311, 112, -143, -385, -540, -554, -413, -153, },
    { 521, 331, 25, -281, -475, -494, -345, -94, 164, 344, 405, 356, 242, 118, 27, -16, -1977, -560, 724, 1011,
      511, -75, -240, 5, 272, 196, -243, -709, -791, -335, 412, 972, 972, 412, -335, -791, -709, -243, 196, 272, 5,
      -240, -75, 511, 1011, 724, -560, -1977, -16, 27, 118, 242, 356, 405, 344, 164, -94, -345, -494, -475, -281,
      25, 331, 521, -179, -467, -575, -467, -193, 135, 390, 488, 411, 209, -29, -215, -300, -281, -196, -95, -1913,
      1595, 1753, 454, -610, -760, -291, 124, 85, -277, -514, -293, 307, 857, 918, 392, -392, -918, -857, -307,
      293, 514, 277, -85, -124, 291, 760, 610, -454, -1753, -1595, 1913, 95, 196, 281, 300, 215, 29, -209, -411,
      -488, -390, -135, 193, 467, 575, 467, 179, },
    { -354, -201, 38, 256, 361, 312, 137, -84, -259, -324, -270, -138, 6, 103, 129, 94, 3390, -1378, -2958, -1669,
      657, 2102, 1826, 334, -1135, -1570, -840, 351, 1067, 841, -34, -787, -787, -34, 841, 1067, 351, -840, -1570,
      -1135, 334, 1826, 2102, 657, -1669, -2958, -1378, 3390, 94, 129, 103, 6, -138, -270, -324, -259, -84, 137,
      312, 361, 256, 38, -201, -354, 133, 339, 398, 284, 51, -199, -360, -369, -230, -8, 208, 341, 362, 287, 168,
      59, -510, -1996, -502, 1369, 1900, 918, -592, -1462, -1188, -158, 775, 969, 421, -320, -632, -309, 309, 632,
      320, -421, -969, -775, 158, 1188, 1462, 592, -918, -1900, -1369, 502, 1996, 510, -59, -168, -287, -362,
      -341, -208, 8, 230, 369, 360, 199, -51, -284, -398, -339, -133, },
    { 147, 75, -33, -125, -156, -112, -16, 86, 147, 141, 76, -15, -91, -124, -108, -63, -1416, 1448, 1684, 213,
      -1328, -1694, -716, 780, 1671, 1335, 48, -1262, -1678, -922, 472, 1537, 1537, 472, -922, -1678, -1262, 48,
      1335, 1671, 780, -716, -1694, -1328, 213, 1684, 1448, -1416, -63, -108, -124, -91, -15, 76, 141, 147, 86,
      -16, -112, -156, -125, -33, 75, 147, -55, -139, -156, -99, 5, 106, 159, 140, 59, -46, -133, -171, -155, -102,
      -42, 0, 1295, 510, -846, -1413, -781, 475, 1368, 1245, 217, -966, -1468, -946, 231, 1249, 1411, 609, -609,
      -1411, -1249, -231, 946, 1468, 966, -217, -1245, -1368, -475, 781, 1413, 846, -510, -1295, 0, 42, 102, 155,
      171, 133, 46, -59, -140, -159, -106, -5, 99, 156, 139, 55, },
};

int16_t g_as_rxiq_bw80m_siso_h_comp_320m[HI1103_CALI_RXIQ_LS_FILTER_TAP_NUM_320M][HI1103_RXIQ_LSFIR_FEQ_NUM_320M] = {
    { 272, 123, -92, -257, -282, -154, 58, 238, 289, 185, -17, -209, -291, -220, -37, 163, 279, 258, 117, -71,
      -218, -267, -218, -114, -1801, 2917, 2340, -787, -2956, -2318, 367, 2704, 2704, 367, -2318, -2956, -787,
      2340, 2917, -1801, -114, -218, -267, -218, -71, 117, 258, 279, 163, -37, -220, -291, -209, -17, 185, 289,
      238, 58, -154, -282, -257, -92, 123, 272, 100, 245, 259, 133, -64, -227, -268, -167, 22, 200, 273, 204, 31,
      -158, -268, -246, -108, 79, 230, 289, 248, 147, 44, -18, -2636, -245, 2149, 2364, 444, -1837, -2564, -1175,
      1175, 2564, 1837, -444, -2364, -2149, 245, 2636, 18, -44, -147, -248, -289, -230, -79, 108, 246, 268, 158,
      -31, -204, -273, -200, -22, 167, 268, 227, 64, -133, -259, -245, -100, },
    { -542, -282, 111, 446, 563, 411, 70, -291, -503, -474, -229, 103, 368, 451, 333, 87, -168, -326, -343, -243,
      -97, 23, 77, 67, 2645, -829, -1883, -909, 467, 921, 349, -373, -373, 349, 921, 467, -909, -1883, -829, 2645,
      67, 77, 23, -97, -243, -343, -326, -168, 87, 333, 451, 368, 103, -229, -474, -503, -291, 70, 411, 563, 446,
      111, -282, -542, -203, -510, -571, -358, 22, 383, 553, 459, 154, -209, -458, -485, -292, 17, 296, 424, 363,
      160, -82, -263, -328, -283, -177, -71, -415, 1625, 810, -497, -922, -495, 18, 94, -94, -18, 495, 922, 497,
      -810, -1625, 415, 71, 177, 283, 328, 263, 82, -160, -363, -424, -296, -17, 292, 485, 458, 209, -154, -459,
      -553, -383, -22, 358, 571, 510, 203, },
    { 506, 333, 47, -256, -471, -525, -397, -132, 176, 421, 515, 430, 199, -92, -337, -455, -416, -247, -21, 179,
      291, 297, 222, 115, 2504, -2082, -2382, -482, 1202, 1364, 284, -789, -789, 284, 1364, 1202, -482, -2382,
      -2082, 2504, 115, 222, 297, 291, 179, -21, -247, -416, -455, -337, -92, 199, 430, 515, 421, 176, -132,
      -397, -525, -471, -256, 47, 333, 506, 161, 426, 541, 466, 230, -83, -361, -509, -478, -286, -4, 268, 438,
      457, 329, 106, -131, -310, -389, -365, -270, -151, -52, 4, 1894, 864, -620, -1232, -792, 45, 496, 272,
      -272, -496, -45, 792, 1232, 620, -864, -1894, -4, 52, 151, 270, 365, 389, 310, 131, -106, -329, -457,
      -438, -268, 4, 286, 478, 509, 361, 83, -230, -466, -541, -426, -161, },
    { -463, -367, -188, 40, 272, 452, 531, 479, 298, 34, -245, -458, -547, -489, -308, -62, 177, 351, 426, 407,
      321, 209, 107, 35, -177, -1205, -817, -95, 367, 448, 306, 163, 163, 306, 448, 367, -95, -817, -1205, -177,
      35, 107, 209, 321, 407, 426, 351, 177, -62, -308, -489, -547, -458, -245, 34, 298, 479, 531, 452, 272, 40,
      -188, -367, -463, -99, -284, -423, -486, -442, -284, -35, 246, 478, 586, 529, 320, 24, -265, -461, -513,
      -426, -247, -47, 109, 188, 190, 141, 77, 2437, -442, -1232, -899, -345, -14, 67, 31, -31, -67, 14, 345,
      899, 1232, 442, -2437, -77, -141, -190, -188, -109, 47, 247, 426, 513, 461, 265, -24, -320, -529, -586,
      -478, -246, 35, 284, 442, 486, 423, 284, 99, },
    { 522, 432, 272, 77, -117, -284, -407, -477, -488, -434, -312, -130, 89, 305, 469, 541, 505, 378, 203, 35,
      -84, -132, -119, -73, -2540, 307, 857, 100, -598, -446, 395, 1150, 1150, 395, -446, -598, 100, 857, 307,
      -2540, -73, -119, -132, -84, 35, 203, 378, 505, 541, 469, 305, 89, -130, -312, -434, -488, -477, -407,
      -284, -117, 77, 272, 432, 522, 114, 318, 458, 512, 483, 389, 253, 95, -74, -243, -394, -502, -536, -476,
      -320, -94, 149, 354, 472, 488, 415, 293, 165, 66, 1001, -980, -921, -389, -194, -324, -399, -185, 185,
      399, 324, 194, 389, 921, 980, -1001, -66, -165, -293, -415, -488, -472, -354, -149, 94, 320, 476, 536,
      502, 394, 243, 74, -95, -253, -389, -483, -512, -458, -318, -114, },
    { -504, -464, -383, -267, -124, 31, 181, 310, 407, 469, 497, 491, 451, 369, 245, 81, -101, -273, -399, -454,
      -430, -341, -222, -108, -2701, 1072, 1401, 191, -741, -544, 480, 1380, 1380, 480, -544, -741, 191, 1401,
      1072, -2701, -108, -222, -341, -430, -454, -399, -273, -101, 81, 245, 369, 451, 491, 497, 469, 407, 310,
      181, 31, -124, -267, -383, -464, -504, -80, -231, -356, -445, -492, -498, -468, -404, -310, -187, -43,
      114, 268, 399, 489, 524, 503, 432, 331, 221, 123, 50, 6, -11, -1183, -626, -170, -111, -346, -576, -552,
      -227, 227, 552, 576, 346, 111, 170, 626, 1183, 11, -6, -50, -123, -221, -331, -432, -503, -524, -489,
      -399, -268, -114, 43, 187, 310, 404, 468, 498, 492, 445, 356, 231, 80, },
    { 502, 487, 454, 403, 333, 246, 147, 43, -60, -155, -240, -316, -383, -442, -490, -522, -530, -508, -456,
      -377, -282, -187, -104, -43, -707, 695, 728, 281, 4, 131, 516, 832, 832, 516, 131, 4, 281, 728, 695, -707,
      -43, -104, -187, -282, -377, -456, -508, -530, -522, -490, -442, -383, -316, -240, -155, -60, 43, 147,
      246, 333, 403, 454, 487, 502, 33, 108, 202, 310, 416, 495, 531, 523, 485, 440, 405, 382, 356, 303, 208,
      69, -91, -239, -338, -370, -335, -255, -160, -78, -2464, -21, 392, -50, -491, -600, -432, -151, 151, 432,
      600, 491, 50, -392, 21, 2464, 78, 160, 255, 335, 370, 338, 239, 91, -69, -208, -303, -356, -382, -405,
      -440, -485, -523, -531, -495, -416, -310, -202, -108, -33, },
    { -519, -509, -492, -473, -457, -440, -420, -390, -348, -299, -250, -207, -171, -137, -96, -42, 28, 103, 167,
      204, 204, 170, 116, 60, 1810, -195, -351, 376, 993, 994, 512, 57, 57, 512, 994, 993, 376, -351, -195, 1810,
      60, 116, 170, 204, 204, 167, 103, 28, -42, -96, -137, -171, -207, -250, -299, -348, -390, -420, -440, -457,
      -473, -492, -509, -519, -39, -109, -157, -184, -202, -227, -271, -334, -401, -453, -476, -472, -455, -445,
      -460, -500, -548, -580, -571, -510, -406, -281, -163, -73, -1932, 210, 414, -42, -370, -376, -214, -61, 61,
      214, 376, 370, 42, -414, -210, 1932, 73, 163, 281, 406, 510, 571, 580, 548, 500, 460, 445, 455, 472, 476,
      453, 401, 334, 271, 227, 202, 184, 157, 109, 39, },
    { 505, 511, 518, 520, 516, 508, 501, 502, 511, 523, 529, 524, 508, 490, 483, 496, 527, 560, 574, 546, 469,
      354, 223, 108, 2927, -639, -853, 420, 1437, 1376, 504, -294, -294, 504, 1376, 1437, 420, -853, -639, 2927,
      108, 223, 354, 469, 546, 574, 560, 527, 496, 483, 490, 508, 524, 529, 523, 511, 502, 501, 508, 516, 520,
      518, 511, 505, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, },
    { -519, -509, -492, -473, -457, -440, -420, -390, -348, -299, -250, -207, -171, -137, -96, -42, 28, 103, 167,
      204, 204, 170, 116, 60, 1810, -195, -351, 376, 993, 994, 512, 57, 57, 512, 994, 993, 376, -351, -195, 1810,
      60, 116, 170, 204, 204, 167, 103, 28, -42, -96, -137, -171, -207, -250, -299, -348, -390, -420, -440, -457,
      -473, -492, -509, -519, 39, 109, 157, 184, 202, 227, 271, 334, 401, 453, 476, 472, 455, 445, 460, 500, 548,
      580, 571, 510, 406, 281, 163, 73, 1932, -210, -414, 42, 370, 376, 214, 61, -61, -214, -376, -370, -42, 414,
      210, -1932, -73, -163, -281, -406, -510, -571, -580, -548, -500, -460, -445, -455, -472, -476, -453, -401,
      -334, -271, -227, -202, -184, -157, -109, -39, },
    { 502, 487, 454, 403, 333, 246, 147, 43, -60, -155, -240, -316, -383, -442, -490, -522, -530, -508, -456,
      -377, -282, -187, -104, -43, -707, 695, 728, 281, 4, 131, 516, 832, 832, 516, 131, 4, 281, 728, 695, -707,
      -43, -104, -187, -282, -377, -456, -508, -530, -522, -490, -442, -383, -316, -240, -155, -60, 43, 147, 246,
      333, 403, 454, 487, 502, -33, -108, -202, -310, -416, -495, -531, -523, -485, -440, -405, -382, -356, -303,
      -208, -69, 91, 239, 338, 370, 335, 255, 160, 78, 2464, 21, -392, 50, 491, 600, 432, 151, -151, -432, -600,
      -491, -50, 392, -21, -2464, -78, -160, -255, -335, -370, -338, -239, -91, 69, 208, 303, 356, 382, 405, 440,
      485, 523, 531, 495, 416, 310, 202, 108, 33, },
    { -504, -464, -383, -267, -124, 31, 181, 310, 407, 469, 497, 491, 451, 369, 245, 81, -101, -273, -399, -454,
      -430, -341, -222, -108, -2701, 1072, 1401, 191, -741, -544, 480, 1380, 1380, 480, -544, -741, 191, 1401,
      1072, -2701, -108, -222, -341, -430, -454, -399, -273, -101, 81, 245, 369, 451, 491, 497, 469, 407, 310,
      181, 31, -124, -267, -383, -464, -504, 80, 231, 356, 445, 492, 498, 468, 404, 310, 187, 43, -114, -268,
      -399, -489, -524, -503, -432, -331, -221, -123, -50, -6, 11, 1183, 626, 170, 111, 346, 576, 552, 227, -227,
      -552, -576, -346, -111, -170, -626, -1183, -11, 6, 50, 123, 221, 331, 432, 503, 524, 489, 399, 268, 114,
      -43, -187, -310, -404, -468, -498, -492, -445, -356, -231, -80, },
    { 522, 432, 272, 77, -117, -284, -407, -477, -488, -434, -312, -130, 89, 305, 469, 541, 505, 378, 203, 35,
      -84, -132, -119, -73, -2540, 307, 857, 100, -598, -446, 395, 1150, 1150, 395, -446, -598, 100, 857, 307,
      -2540, -73, -119, -132, -84, 35, 203, 378, 505, 541, 469, 305, 89, -130, -312, -434, -488, -477, -407,
      -284, -117, 77, 272, 432, 522, -114, -318, -458, -512, -483, -389, -253, -95, 74, 243, 394, 502, 536, 476,
      320, 94, -149, -354, -472, -488, -415, -293, -165, -66, -1001, 980, 921, 389, 194, 324, 399, 185, -185,
      -399, -324, -194, -389, -921, -980, 1001, 66, 165, 293, 415, 488, 472, 354, 149, -94, -320, -476, -536,
      -502, -394, -243, -74, 95, 253, 389, 483, 512, 458, 318, 114, },
    { -463, -367, -188, 40, 272, 452, 531, 479, 298, 34, -245, -458, -547, -489, -308, -62, 177, 351, 426, 407,
      321, 209, 107, 35, -177, -1205, -817, -95, 367, 448, 306, 163, 163, 306, 448, 367, -95, -817, -1205, -177,
      35, 107, 209, 321, 407, 426, 351, 177, -62, -308, -489, -547, -458, -245, 34, 298, 479, 531, 452, 272, 40,
      -188, -367, -463, 99, 284, 423, 486, 442, 284, 35, -246, -478, -586, -529, -320, -24, 265, 461, 513, 426,
      247, 47, -109, -188, -190, -141, -77, -2437, 442, 1232, 899, 345, 14, -67, -31, 31, 67, -14, -345, -899,
      -1232, -442, 2437, 77, 141, 190, 188, 109, -47, -247, -426, -513, -461, -265, 24, 320, 529, 586, 478, 246,
      -35, -284, -442, -486, -423, -284, -99, },
    { 506, 333, 47, -256, -471, -525, -397, -132, 176, 421, 515, 430, 199, -92, -337, -455, -416, -247, -21, 179,
      291, 297, 222, 115, 2504, -2082, -2382, -482, 1202, 1364, 284, -789, -789, 284, 1364, 1202, -482, -2382,
      -2082, 2504, 115, 222, 297, 291, 179, -21, -247, -416, -455, -337, -92, 199, 430, 515, 421, 176, -132,
      -397, -525, -471, -256, 47, 333, 506, -161, -426, -541, -466, -230, 83, 361, 509, 478, 286, 4, -268, -438,
      -457, -329, -106, 131, 310, 389, 365, 270, 151, 52, -4, -1894, -864, 620, 1232, 792, -45, -496, -272, 272,
      496, 45, -792, -1232, -620, 864, 1894, 4, -52, -151, -270, -365, -389, -310, -131, 106, 329, 457, 438, 268,
      -4, -286, -478, -509, -361, -83, 230, 466, 541, 426, 161, },
    { -542, -282, 111, 446, 563, 411, 70, -291, -503, -474, -229, 103, 368, 451, 333, 87, -168, -326, -343, -243,
      -97, 23, 77, 67, 2645, -829, -1883, -909, 467, 921, 349, -373, -373, 349, 921, 467, -909, -1883, -829,
      2645, 67, 77, 23, -97, -243, -343, -326, -168, 87, 333, 451, 368, 103, -229, -474, -503, -291, 70, 411,
      563, 446, 111, -282, -542, 203, 510, 571, 358, -22, -383, -553, -459, -154, 209, 458, 485, 292, -17, -296,
      -424, -363, -160, 82, 263, 328, 283, 177, 71, 415, -1625, -810, 497, 922, 495, -18, -94, 94, 18, -495,
      -922, -497, 810, 1625, -415, -71, -177, -283, -328, -263, -82, 160, 363, 424, 296, 17, -292, -485, -458,
      -209, 154, 459, 553, 383, 22, -358, -571, -510, -203, },
    { 272, 123, -92, -257, -282, -154, 58, 238, 289, 185, -17, -209, -291, -220, -37, 163, 279, 258, 117, -71,
      -218, -267, -218, -114, -1801, 2917, 2340, -787, -2956, -2318, 367, 2704, 2704, 367, -2318, -2956, -787,
      2340, 2917, -1801, -114, -218, -267, -218, -71, 117, 258, 279, 163, -37, -220, -291, -209, -17, 185, 289,
      238, 58, -154, -282, -257, -92, 123, 272, -100, -245, -259, -133, 64, 227, 268, 167, -22, -200, -273, -204,
      -31, 158, 268, 246, 108, -79, -230, -289, -248, -147, -44, 18, 2636, 245, -2149, -2364, -444, 1837, 2564,
      1175, -1175, -2564, -1837, 444, 2364, 2149, -245, -2636, -18, 44, 147, 248, 289, 230, 79, -108, -246, -268,
      -158, 31, 204, 273, 200, 22, -167, -268, -227, -64, 133, 259, 245, 100, },
};

int16_t g_625k_160m_tone_lut[NUM_160M_SNGL_TONE_1_4_CIRCLE * NUM_BW_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1158, 1157, 1155, 1153, 1150, 1146, 1141,
    1136, 1130, 1124, 1117, 1109, 1100, 1091, 1081,
    1070, 1059, 1047, 1035, 1022, 1008, 994, 979,
    963, 947, 931, 913, 896, 877, 858, 839,
    819, 799, 778, 757, 735, 713, 690, 667,
    644, 620, 596, 571, 546, 521, 495, 469,
    443, 417, 390, 363, 336, 309, 281, 254,
    226, 198, 170, 142, 114, 85, 57, 28, 0
};

int16_t g_625k_320m_tone_lut[NUM_320M_SNGL_TONE_1_4_CIRCLE * NUM_BW_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1158, 1158, 1158, 1157, 1156, 1155, 1154, 1153, 1151, 1150, 1148, 1146, 1144, 1141, 1139,
    1136, 1133, 1130, 1127, 1124, 1120, 1117, 1113, 1109, 1104, 1100, 1096, 1091, 1086, 1081, 1076,
    1070, 1065, 1059, 1053, 1047, 1041, 1035, 1028, 1022, 1015, 1008, 1001, 994, 986, 979, 971,
    963, 955, 947, 939, 931, 922, 913, 905, 896, 886, 877, 868, 858, 849, 839, 829,
    819, 809, 799, 788, 778, 767, 757, 746, 735, 724, 713, 701, 690, 679, 667, 655,
    644, 632, 620, 608, 596, 583, 571, 559, 546, 534, 521, 508, 495, 482, 469, 456,
    443, 430, 417, 404, 390, 377, 363, 350, 336, 323, 309, 295, 281, 268, 254, 240,
    226, 212, 198, 184, 170, 156, 142, 128, 114, 99, 85, 71, 57, 43, 28, 14, 0
};

int16_t g_625k_640m_tone_lut[NUM_640M_SNGL_TONE_1_4_CIRCLE * NUM_BW_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1159, 1158, 1158, 1158, 1158, 1158, 1157, 1157, 1157, 1156, 1156, 1155, 1155, 1154, 1154,
    1153, 1152, 1151, 1151, 1150, 1149, 1148, 1147, 1146, 1145, 1144, 1143, 1141, 1140, 1139, 1138,
    1136, 1135, 1133, 1132, 1130, 1129, 1127, 1126, 1124, 1122, 1120, 1118, 1117, 1115, 1113, 1111,
    1109, 1107, 1104, 1102, 1100, 1098, 1096, 1093, 1091, 1088, 1086, 1083, 1081, 1078, 1076, 1073,
    1070, 1068, 1065, 1062, 1059, 1056, 1053, 1050, 1047, 1044, 1041, 1038, 1035, 1032, 1028, 1025,
    1022, 1018, 1015, 1012, 1008, 1004, 1001, 997, 994, 990, 986, 983, 979, 975, 971, 967,
    963, 959, 955, 951, 947, 943, 939, 935, 931, 926, 922, 918, 913, 909, 905, 900,
    896, 891, 886, 882, 877, 873, 868, 863, 858, 854, 849, 844, 839, 834, 829, 824,
    819, 814, 809, 804, 799, 794, 788, 783, 778, 773, 767, 762, 757, 751, 746, 740,
    735, 729, 724, 718, 713, 707, 701, 696, 690, 684, 679, 673, 667, 661, 655, 650,
    644, 638, 632, 626, 620, 614, 608, 602, 596, 589, 583, 577, 571, 565, 559, 552,
    546, 540, 534, 527, 521, 515, 508, 502, 495, 489, 482, 476, 469, 463, 456, 450,
    443, 437, 430, 424, 417, 410, 404, 397, 390, 384, 377, 370, 363, 357, 350, 343,
    336, 329, 323, 316, 309, 302, 295, 288, 281, 275, 268, 261, 254, 247, 240, 233,
    226, 219, 212, 205, 198, 191, 184, 177, 170, 163, 156, 149, 142, 135, 128, 121,
    114, 106, 99, 92, 85, 78, 71, 64, 57, 50, 43, 36, 28, 21, 14, 7, 0
};

int16_t g_160m_tone_lut[NUM_160M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1153, 1136, 1109, 1070, 1022, 963, 896, 819, 735, 644, 546, 443, 336, 226, 114, 0
};

int16_t g_320m_tone_lut[NUM_320M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1157, 1153, 1146, 1136, 1124, 1109, 1091,
    1070, 1047, 1022, 994, 963, 931, 896, 858,
    819, 778, 735, 690, 644, 596, 546, 495,
    443, 390, 336, 281, 226, 170, 114, 57, 0
};

int16_t g_640m_tone_lut[NUM_640M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1158, 1157, 1155, 1153, 1150, 1146, 1141, 1136, 1130, 1124, 1117, 1109, 1100, 1091, 1081,
    1070, 1059, 1047, 1035, 1022, 1008, 994, 979, 963, 947, 931, 913, 896, 877, 858, 839,
    819, 799, 778, 757, 735, 713, 690, 667, 644, 620, 596, 571, 546, 521, 495, 469,
    443, 417, 390, 363, 336, 309, 281, 254, 226, 198, 170, 142, 114, 85, 57, 28, 0
};

int16_t g_as_hi1105_625k_80m_tone_lut[NUM_80M_SNGL_TONE_1_4_CIRCLE * NUM_80M_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1157, 1153, 1146, 1136, 1124, 1109, 1091,
    1070, 1047, 1022, 994, 963, 931, 896, 858,
    819, 778, 735, 690, 644, 596, 546, 495,
    443, 390, 336, 281, 226, 170, 114, 57, 0
};

int16_t g_as_hi1105_625k_160m_tone_lut[NUM_160M_SNGL_TONE_1_4_CIRCLE * NUM_BW_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1158, 1157, 1155, 1153, 1150, 1146, 1141,
    1136, 1130, 1124, 1117, 1109, 1100, 1091, 1081,
    1070, 1059, 1047, 1035, 1022, 1008, 994, 979,
    963, 947, 931, 913, 896, 877, 858, 839,
    819, 799, 778, 757, 735, 713, 690, 667,
    644, 620, 596, 571, 546, 521, 495, 469,
    443, 417, 390, 363, 336, 309, 281, 254,
    226, 198, 170, 142, 114, 85, 57, 28, 0
};

int16_t g_as_hi1105_625k_320m_tone_lut[NUM_320M_SNGL_TONE_1_4_CIRCLE * NUM_BW_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1158, 1158, 1158, 1157, 1156, 1155, 1154, 1153, 1151, 1150, 1148, 1146, 1144, 1141, 1139,
    1136, 1133, 1130, 1127, 1124, 1120, 1117, 1113, 1109, 1104, 1100, 1096, 1091, 1086, 1081, 1076,
    1070, 1065, 1059, 1053, 1047, 1041, 1035, 1028, 1022, 1015, 1008, 1001, 994, 986, 979, 971,
    963, 955, 947, 939, 931, 922, 913, 905, 896, 886, 877, 868, 858, 849, 839, 829,
    819, 809, 799, 788, 778, 767, 757, 746, 735, 724, 713, 701, 690, 679, 667, 655,
    644, 632, 620, 608, 596, 583, 571, 559, 546, 534, 521, 508, 495, 482, 469, 456,
    443, 430, 417, 404, 390, 377, 363, 350, 336, 323, 309, 295, 281, 268, 254, 240,
    226, 212, 198, 184, 170, 156, 142, 128, 114, 99, 85, 71, 57, 43, 28, 14, 0
};

int16_t g_as_hi1105_625k_640m_tone_lut[NUM_640M_SNGL_TONE_1_4_CIRCLE * NUM_BW_SNGL_TONE_1_CIRCLE + 1] = {
    1159, 1159, 1158, 1158, 1158, 1158, 1158, 1157, 1157, 1157, 1156, 1156, 1155, 1155, 1154, 1154,
    1153, 1152, 1151, 1151, 1150, 1149, 1148, 1147, 1146, 1145, 1144, 1143, 1141, 1140, 1139, 1138,
    1136, 1135, 1133, 1132, 1130, 1129, 1127, 1126, 1124, 1122, 1120, 1118, 1117, 1115, 1113, 1111,
    1109, 1107, 1104, 1102, 1100, 1098, 1096, 1093, 1091, 1088, 1086, 1083, 1081, 1078, 1076, 1073,
    1070, 1068, 1065, 1062, 1059, 1056, 1053, 1050, 1047, 1044, 1041, 1038, 1035, 1032, 1028, 1025,
    1022, 1018, 1015, 1012, 1008, 1004, 1001, 997, 994, 990, 986, 983, 979, 975, 971, 967,
    963, 959, 955, 951, 947, 943, 939, 935, 931, 926, 922, 918, 913, 909, 905, 900,
    896, 891, 886, 882, 877, 873, 868, 863, 858, 854, 849, 844, 839, 834, 829, 824,
    819, 814, 809, 804, 799, 794, 788, 783, 778, 773, 767, 762, 757, 751, 746, 740,
    735, 729, 724, 718, 713, 707, 701, 696, 690, 684, 679, 673, 667, 661, 655, 650,
    644, 638, 632, 626, 620, 614, 608, 602, 596, 589, 583, 577, 571, 565, 559, 552,
    546, 540, 534, 527, 521, 515, 508, 502, 495, 489, 482, 476, 469, 463, 456, 450,
    443, 437, 430, 424, 417, 410, 404, 397, 390, 384, 377, 370, 363, 357, 350, 343,
    336, 329, 323, 316, 309, 302, 295, 288, 281, 275, 268, 261, 254, 247, 240, 233,
    226, 219, 212, 205, 198, 191, 184, 177, 170, 163, 156, 149, 142, 135, 128, 121,
    114, 106, 99, 92, 85, 78, 71, 64, 57, 50, 43, 36, 28, 21, 14, 7, 0
};
int16_t g_as_hi1105_80m_tone_lut[NUM_80M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1153, 1136, 1109, 1070, 1022, 963, 896, 819, 735, 644, 546, 443, 336, 226, 114, 0,
};

int16_t g_as_hi1105_160m_tone_lut[NUM_160M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1153, 1136, 1109, 1070, 1022, 963, 896, 819, 735, 644, 546, 443, 336, 226, 114, 0
};

int16_t g_as_hi1105_320m_tone_lut[NUM_320M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1157, 1153, 1146, 1136, 1124, 1109, 1091,
    1070, 1047, 1022, 994, 963, 931, 896, 858,
    819, 778, 735, 690, 644, 596, 546, 495,
    443, 390, 336, 281, 226, 170, 114, 57, 0
};

int16_t g_as_hi1105_640m_tone_lut[NUM_640M_SNGL_TONE_1_4_CIRCLE + 1] = {
    1159, 1158, 1157, 1155, 1153, 1150, 1146, 1141, 1136, 1130, 1124, 1117, 1109, 1100, 1091, 1081,
    1070, 1059, 1047, 1035, 1022, 1008, 994, 979, 963, 947, 931, 913, 896, 877, 858, 839,
    819, 799, 778, 757, 735, 713, 690, 667, 644, 620, 596, 571, 546, 521, 495, 469,
    443, 417, 390, 363, 336, 309, 281, 254, 226, 198, 170, 142, 114, 85, 57, 28, 0
};

/* 是否需要关闭fem校准的标志 */
oal_bool_enum_uint8 g_en_need_close_fem_cali =  OAL_FALSE;

/* 3 函数实现 */
void hmac_add_bound(uint32_t *pul_number, uint32_t bound)
{
    *pul_number = *pul_number + 1;

    if (*pul_number > (bound - 1)) {
        *pul_number -= bound;
    }
}


uint32_t hmac_send_matrix_data(mac_vap_stru *mac_vap, oal_netbuf_stru *netbuf,
    uint8_t *data, int32_t remain_len)
{
    dmac_tx_event_stru       *dmac_tx_event = NULL;
    frw_event_mem_stru       *event_mem     = NULL;
    frw_event_stru           *event         = NULL;
    uint8_t                *data_dst      = NULL;
    uint16_t                frame_len;
    uint32_t                ret;

    /* 分多次下发，直到remain_len为0 */
    while (remain_len > 0) {
        /* 申请事件 */
        event_mem = frw_event_alloc_m(sizeof(dmac_tx_event_stru));
        if (event_mem == NULL) {
            oam_error_log0(mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "{hmac_send_data::event_mem null.}");
            return OAL_ERR_CODE_PTR_NULL;
        }

        /* 填事件头 */
        event = frw_get_event_stru(event_mem);
        frw_event_hdr_init(&(event->st_event_hdr),
                           FRW_EVENT_TYPE_WLAN_CTX,
                           DMAC_WLAN_CTX_EVENT_SUB_TYPE_CALI_MATRIX_HMAC2DMAC,
                           sizeof(dmac_tx_event_stru),
                           FRW_EVENT_PIPELINE_STAGE_1,
                           mac_vap->uc_chip_id,
                           mac_vap->uc_device_id,
                           mac_vap->uc_vap_id);

        /* 填netbuf和cb */
        memset_s(oal_netbuf_cb(netbuf), OAL_TX_CB_LEN, 0, OAL_TX_CB_LEN);
        data_dst = (uint8_t *)(oal_netbuf_data(netbuf));
        frame_len = (uint16_t)oal_min(WLAN_LARGE_NETBUF_SIZE - HMAC_NETBUF_OFFSET, remain_len);
        if (EOK != memcpy_s(data_dst, WLAN_LARGE_NETBUF_SIZE, data - remain_len, (uint32_t)frame_len)) {
            oam_error_log0(0, OAM_SF_ANY, "hmac_send_data::memcpy fail!");
            frw_event_free_m(event_mem);
            return OAL_FAIL;
        }

        /* 填事件 */
        dmac_tx_event               = (dmac_tx_event_stru *)event->auc_event_data;
        dmac_tx_event->pst_netbuf   = netbuf;
        dmac_tx_event->us_frame_len = frame_len;
        dmac_tx_event->us_remain    = (uint16_t)remain_len;

        remain_len -= (WLAN_LARGE_NETBUF_SIZE - HMAC_NETBUF_OFFSET);

        ret = frw_event_dispatch_event(event_mem);
        if (oal_unlikely(ret != OAL_SUCC)) {
            oam_error_log3(mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
                "{hmac_send_data::dispatch event fail ret[%d],remain_len[%d]frame_len[%d].}",
                ret, remain_len, frame_len);

            frw_event_free_m(event_mem);
            return ret;
        }

        /* 释放事件 */
        frw_event_free_m(event_mem);
    }
    return OAL_SUCC;
}


uint32_t hmac_send_cali_matrix_data_1103(mac_vap_stru *pst_mac_vap)
{
    oal_netbuf_stru          *pst_netbuf_matrix_data = NULL;
    uint8_t                *puc_matrix_addr = NULL;
    uint8_t                *puc_param = NULL;
    uint32_t                ret;
    int32_t                 l_remain_len;
    uint8_t                 uc_matrix_idx;
    uint16_t               *pus_matrix_data_addr[HI1103_CALI_MATRIX_DATA_NUMS] = {
        g_as_rxiq_h_comp_80m[0], g_as_rxiq_h_comp_320m[0], g_as_rxiq_bw80m_siso_h_comp_320m[0],
        g_txiq_h_comp_160m[0], g_txiq_h_comp_320m[0], g_txiq_h_comp_640m[0],
        (uint16_t *)g_corram_data_20m, (uint16_t *)g_corram_data_40m, (uint16_t *)g_corram_data_80m,
        g_625k_160m_tone_lut, g_625k_320m_tone_lut, g_625k_640m_tone_lut,
        g_160m_tone_lut, g_320m_tone_lut, g_640m_tone_lut
    };

    uint32_t                aul_matrix_data_size[HI1103_CALI_MATRIX_DATA_NUMS] = {
        960,   /*  大小:16bit * 15 * 32 = 960 Byte */
        4352,  /*  大小:16bit * 17 * 128 = 4352 Byte */
        4352,  /*  大小:16bit * 17 * 128 = 4352 Byte */
        1920,  /*  大小:16bit * 15 * 64 = 1920 Byte */
        3840,  /*  大小:16bit * 15 * 128 = 3840 Byte */
        7680,  /*  大小:16bit * 15 * 256 = 7680 Byte */
        2048,  /*  大小:32bit * 512 = 2048 Byte */
        2048,  /*  大小:32bit * 512 = 2048 Byte */
        2048,  /*  大小:32bit * 512 = 2048 Byte */
        130,   /*  大小:16bit *65 = 130 Byte */
        258,   /*  大小:16bit *129 = 258 Byte */
        514,   /*  大小:16bit *257 = 514 Byte */
        34,   /*  大小:16bit *17 = 34 Byte */
        66,   /*  大小:16bit *33 = 66 Byte */
        130,   /*  大小:16bit *65 = 130 Byte */
    };

    pst_netbuf_matrix_data = oal_mem_netbuf_alloc(OAL_NORMAL_NETBUF, WLAN_LARGE_NETBUF_SIZE, OAL_NETBUF_PRIORITY_MID);
    if (pst_netbuf_matrix_data == NULL) {
        oam_error_log1(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_matrix_data::pst_netbuf alloc null SIZE[%d].}", WLAN_LARGE_NETBUF_SIZE);
        return OAL_ERR_CODE_ALLOC_MEM_FAIL;
    }

    for (uc_matrix_idx = 0; uc_matrix_idx < HI1103_CALI_MATRIX_DATA_NUMS; uc_matrix_idx++) {
        l_remain_len    = (int32_t)aul_matrix_data_size[uc_matrix_idx];
        puc_matrix_addr = (uint8_t *)pus_matrix_data_addr[uc_matrix_idx];
        puc_param     = (uint8_t *)(puc_matrix_addr) + l_remain_len;

        /* 调用公共下发接口 */
        ret = hmac_send_matrix_data(pst_mac_vap, pst_netbuf_matrix_data, puc_param, l_remain_len);
        if (ret != OAL_SUCC) {
            oal_netbuf_free(pst_netbuf_matrix_data);
            return ret;
        }
    }

    oal_netbuf_free(pst_netbuf_matrix_data);

    return OAL_SUCC;
}


uint32_t hmac_send_cali_matrix_data_1105(mac_vap_stru *pst_mac_vap)
{
    oal_netbuf_stru          *pst_netbuf_matrix_data = NULL;
    uint8_t                *puc_matrix_addr = NULL;
    uint8_t                *puc_param = NULL;
    uint32_t                ret;
    int32_t                 l_remain_len;
    uint8_t                 uc_matrix_idx;
    uint16_t               *pus_matrix_data_addr[HI1103_CALI_MATRIX_DATA_NUMS] = {
        (uint16_t *)g_hi1105_rxiq_h_comp_40m[0], (uint16_t *)g_hi1105_rxiq_h_comp_80m_fpga[0],
        (uint16_t *)g_hi1105_rxiq_h_comp_80m[0], (uint16_t *)g_hi1105_rxiq_40m_h_comp_160m[0],
        (uint16_t *)g_hi1105_rxiq_h_comp_160m[0], (uint16_t *)g_hi1105_rxiq_h_comp_320m[0],
        (uint16_t *)g_hi1105_txiq_h_comp_80m[0], (uint16_t *)g_hi1105_txiq_h_comp_160m_fpga[0],
        (uint16_t *)g_hi1105_txiq_h_comp_160m[0], (uint16_t *)g_hi1105_2g_txiq_h_comp_320m[0],
        (uint16_t *)g_hi1105_txiq_h_comp_320m[0], (uint16_t *)g_hi1105_txiq_h_comp_640m[0],
        (uint16_t *)g_corram_data_20m, (uint16_t *)g_corram_data_40m, (uint16_t *)g_corram_data_80m,
        g_as_hi1105_625k_80m_tone_lut, g_as_hi1105_625k_160m_tone_lut, g_as_hi1105_625k_320m_tone_lut,
        g_as_hi1105_625k_640m_tone_lut, g_as_hi1105_80m_tone_lut, g_as_hi1105_160m_tone_lut,
        g_as_hi1105_320m_tone_lut, g_as_hi1105_640m_tone_lut
    };

    /*
     * 大小:64bit * 7 * 16 = 896 Byte
     * 大小:64bit * 7 * 32 = 1792 Byte
     * 大小:64bit * 7 * 16 = 896 Byte
     * 大小:64bit * 7 * 16 = 896 Byte
     * 大小:64bit * 7 * 32 = 1792 Byte
     * 大小:64bit * 7 * 64 = 3584 Byte
     * 大小:64bit * 7 * 32 = 1792 Byte
     * 大小:64bit * 7 * 64 = 3584 Byte
     * 大小:64bit * 7 * 32 = 1792 Byte
     * 大小:64bit * 7 * 64 = 3584 Byte
     * 大小:64bit * 7 * 64 = 3584 Byte
     * 大小:64bit * 7 * 128 = 7168 Byte
     * 大小:32bit * 512 = 2048 Byte
     * 大小:32bit * 512 = 2048 Byte
     * 大小:32bit * 512 = 2048 Byte
     * 大小:16bit *33 = 130 Byte
     * 大小:16bit *65 = 130 Byte
     * 大小:16bit *129 = 258 Byte
     * 大小:16bit *257 = 514 Byte
     * 大小:16bit *17 = 34 Byte
     * 大小:16bit *17 = 34 Byte
     * 大小:16bit *33 = 66 Byte
     * 大小:16bit *65 = 130 Byte
     */
    uint32_t                aul_matrix_data_size[HI1103_CALI_MATRIX_DATA_NUMS] = {
        896, 1792, 896, 1792, 1792, 3584, 1792, 3584, 1792, 3584, 3584, 7168,
        2048, 2048, 2048, 66, 130, 258, 514, 34, 34, 66, 130,
    };

    pst_netbuf_matrix_data = oal_mem_netbuf_alloc(OAL_NORMAL_NETBUF, WLAN_LARGE_NETBUF_SIZE, OAL_NETBUF_PRIORITY_MID);
    if (pst_netbuf_matrix_data == NULL) {
        oam_error_log1(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_matrix_data::pst_netbuf alloc null SIZE[%d].}",
            WLAN_LARGE_NETBUF_SIZE);
        return OAL_ERR_CODE_ALLOC_MEM_FAIL;
    }

    for (uc_matrix_idx = 0; uc_matrix_idx < HI1103_CALI_MATRIX_DATA_NUMS; uc_matrix_idx++) {
        l_remain_len    = (int32_t)aul_matrix_data_size[uc_matrix_idx];
        puc_matrix_addr = (uint8_t *)pus_matrix_data_addr[uc_matrix_idx];
        puc_param     = (uint8_t *)(puc_matrix_addr) + l_remain_len;

        /* 调用公共下发接口 */
        ret = hmac_send_matrix_data(pst_mac_vap, pst_netbuf_matrix_data, puc_param, l_remain_len);
        if (ret != OAL_SUCC) {
            oal_netbuf_free(pst_netbuf_matrix_data);
            return ret;
        }
    }

    oal_netbuf_free(pst_netbuf_matrix_data);

    return OAL_SUCC;
}


uint32_t hmac_send_cali_matrix_data_shenkuo(mac_vap_stru *mac_vap)
{
    oal_netbuf_stru     *netbuf_matrix_data = NULL;
    uint8_t             *matrix_addr = NULL;
    uint8_t             *param = NULL;
    uint32_t            ret;
    int32_t             remain_len;
    uint8_t             matrix_idx;
    uint16_t            *matrix_data_addr[SHENKUO_CALI_MATRIX_DATA_NUMS] = { (uint16_t *)g_dpd_corram_data };
    uint32_t            matrix_data_size[SHENKUO_CALI_MATRIX_DATA_NUMS] = {
        WLAN_CALI_DPD_CORRAM_DATA_SIZE,  /*  大小:32bit * 3072 = 12288 Byte */
    };

    netbuf_matrix_data = oal_mem_netbuf_alloc(OAL_NORMAL_NETBUF, WLAN_LARGE_NETBUF_SIZE, OAL_NETBUF_PRIORITY_MID);
    if (netbuf_matrix_data == NULL) {
        oam_error_log1(mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_matrix_data::pst_netbuf alloc null SIZE[%d].}",
            WLAN_LARGE_NETBUF_SIZE);
        return OAL_ERR_CODE_ALLOC_MEM_FAIL;
    }

    for (matrix_idx = 0; matrix_idx < SHENKUO_CALI_MATRIX_DATA_NUMS; matrix_idx++) {
        remain_len    = (int32_t)matrix_data_size[matrix_idx];
        matrix_addr = (uint8_t *)matrix_data_addr[matrix_idx];
        param     = (uint8_t *)(matrix_addr) + remain_len;

        /* 调用公共下发接口 */
        ret = hmac_send_matrix_data(mac_vap, netbuf_matrix_data, param, remain_len);
        if (ret != OAL_SUCC) {
            oal_netbuf_free(netbuf_matrix_data);
            return ret;
        }
    }

    oal_netbuf_free(netbuf_matrix_data);
    return OAL_SUCC;
}
#define HMAC_NETBUF_REMAIN_MAX_DIFF_LEN 104
static uint32_t hmac_post_cali_data_event(mac_vap_stru *mac_vap, oal_netbuf_stru *netbuf,
    uint8_t *cali_data, int32_t *remain_len)
{
    frw_event_mem_stru *evt_mem = NULL;
    frw_event_stru *evt = NULL;
    dmac_tx_event_stru *cali_data_evt = NULL;
    uint32_t ret;
    uint16_t frame_len;
    evt_mem = frw_event_alloc_m(sizeof(dmac_tx_event_stru));
    if (evt_mem == NULL) {
        oam_error_log0(mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "{hmac_send_cali_data_event::pst_event_mem null.}");
        return OAL_ERR_CODE_PTR_NULL;
    }

    evt = frw_get_event_stru(evt_mem);
    frw_event_hdr_init(&(evt->st_event_hdr),
        FRW_EVENT_TYPE_WLAN_CTX, DMAC_WLAN_CTX_EVENT_SUB_TYPE_CALI_HMAC2DMAC,
        sizeof(dmac_tx_event_stru), FRW_EVENT_PIPELINE_STAGE_1,
        mac_vap->uc_chip_id, mac_vap->uc_device_id, mac_vap->uc_vap_id);

    memset_s(oal_netbuf_cb(netbuf), OAL_TX_CB_LEN, 0, OAL_TX_CB_LEN);

    /* netbuf len 不能超过1544字节 */
    frame_len = (uint16_t)oal_min(WLAN_LARGE_NETBUF_SIZE - HMAC_NETBUF_REMAIN_MAX_DIFF_LEN, *remain_len);
    /*lint -e662*/
    if (memcpy_s(oal_netbuf_data(netbuf), WLAN_LARGE_NETBUF_SIZE,
        cali_data - *remain_len, (uint32_t)frame_len) != EOK) {
        oam_error_log0(mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "hmac_send_cali_data_event::memcpy fail!");
        frw_event_free_m(evt_mem);
        return OAL_FAIL;
    }
    /*lint +e662*/
    cali_data_evt = (dmac_tx_event_stru *)evt->auc_event_data;
    cali_data_evt->pst_netbuf = netbuf;
    cali_data_evt->us_frame_len = frame_len;
    cali_data_evt->us_remain = (uint16_t)*remain_len;

    *remain_len -= (WLAN_LARGE_NETBUF_SIZE - HMAC_NETBUF_REMAIN_MAX_DIFF_LEN);

    ret = frw_event_dispatch_event(evt_mem);
    if (oal_unlikely(ret != OAL_SUCC)) {
        oam_error_log3(mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_data_event::dispatch event fail ret[%d], remain_len[%d] frame_len[%d].}",
            ret, *remain_len, frame_len);
    }

    frw_event_free_m(evt_mem);
    return ret;
}

uint32_t hmac_send_cali_data_1103(mac_vap_stru *pst_mac_vap, wlan_h2d_cali_data_type_enum_uint8 data_type)
{
    oal_netbuf_stru          *pst_netbuf_cali_data = NULL;
    hi1103_cali_param_stru   *pst_cali_data = NULL;
    uint8_t                *puc_param = NULL;
    uint32_t                ret;
    int32_t                 l_remain_len;
    uint8_t                 uc_chan_idx;
    oal_bool_enum_uint8       en_save_all;
    uint8_t                *puc_mem_addr = NULL;

    oam_info_log0(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "hmac_send_cali_data:start!");
    puc_mem_addr = get_cali_data_buf_addr();
    if (puc_mem_addr == NULL) {
        return OAL_ERR_CODE_PTR_NULL; // coverity err 61 fix
    }
    pst_cali_data = (hi1103_cali_param_stru *)puc_mem_addr;
    pst_cali_data->en_need_close_fem_cali = g_en_need_close_fem_cali;
    hmac_dump_cali_result();

    pst_netbuf_cali_data = oal_mem_netbuf_alloc(OAL_NORMAL_NETBUF, WLAN_LARGE_NETBUF_SIZE, OAL_NETBUF_PRIORITY_MID);
    if (pst_netbuf_cali_data == NULL) {
        oam_error_log1(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_data::pst_netbuf alloc null SIZE[%d].}", WLAN_LARGE_NETBUF_SIZE);
        return OAL_ERR_CODE_ALLOC_MEM_FAIL;
    }

    for (uc_chan_idx = 0; uc_chan_idx < WLAN_RF_CHANNEL_NUMS; uc_chan_idx++) {
        l_remain_len  = RF_SINGLE_CHAN_CALI_DATA_BUF_LEN; /* 单通道下发wifi校准长度 */
        pst_cali_data += uc_chan_idx;
        en_save_all = pst_cali_data->en_save_all;

        if (en_save_all == OAL_FALSE) {
            /* FPGA上校准数据不做上传下发，直接返回 */
            oam_warning_log1(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
                "hmac_send_cali_data::ch[%d] no cali data is delivered to host yet", uc_chan_idx);
            oal_netbuf_free(pst_netbuf_cali_data);
            return OAL_FAIL;
        }
        /*lint -e662*/
        puc_param = (uint8_t *)(&(pst_cali_data->ast_2gcali_param)) + l_remain_len;
        /*lint +e662*/
        while (l_remain_len > 0) {
            ret = hmac_post_cali_data_event(pst_mac_vap, pst_netbuf_cali_data, puc_param, &l_remain_len);
            if (ret != OAL_SUCC) {
                oal_netbuf_free(pst_netbuf_cali_data);
                return ret;
            }
        }
    }

    oam_info_log0(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "hmac_send_cali_data:end!");
    oal_netbuf_free(pst_netbuf_cali_data);

    return OAL_SUCC;
}

uint32_t hmac_send_cali_data_1105(mac_vap_stru *pst_mac_vap, wlan_h2d_cali_data_type_enum_uint8 data_type)
{
    oal_netbuf_stru          *pst_netbuf_cali_data = NULL;
    hi1105_cali_param_stru   *pst_1105_cali_data = NULL;
    uint8_t                *puc_param = NULL;
    uint32_t                ret;
    int32_t                 l_remain_len;
    uint8_t                 uc_chan_idx;
    oal_bool_enum_uint8       en_save_all;
    uint8_t                *puc_mem_addr = NULL;

    oam_info_log0(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "hmac_send_cali_data:start!");
    puc_mem_addr = get_cali_data_buf_addr();
    if (puc_mem_addr == NULL) {
        return OAL_ERR_CODE_PTR_NULL; // coverity err 61 fix
    }
    pst_1105_cali_data = (hi1105_cali_param_stru *)puc_mem_addr;
    pst_1105_cali_data->en_need_close_fem_cali = g_en_need_close_fem_cali;
    hmac_dump_cali_result_1105();

    pst_netbuf_cali_data = oal_mem_netbuf_alloc(OAL_NORMAL_NETBUF, WLAN_LARGE_NETBUF_SIZE, OAL_NETBUF_PRIORITY_MID);
    if (pst_netbuf_cali_data == NULL) {
        oam_error_log1(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_data::pst_netbuf alloc null SIZE[%d].}", WLAN_LARGE_NETBUF_SIZE);
        return OAL_ERR_CODE_ALLOC_MEM_FAIL;
    }

    for (uc_chan_idx = 0; uc_chan_idx < WLAN_RF_CHANNEL_NUMS; uc_chan_idx++) {
        /* 单通道下发wifi校准长度 */
        l_remain_len  = HI1105_SINGLE_CHAN_CALI_DATA_BUF_LEN - sizeof(pst_1105_cali_data->dog_tag);
        pst_1105_cali_data += uc_chan_idx;
        en_save_all = pst_1105_cali_data->en_save_all;

        if (en_save_all == OAL_FALSE) {
            /* FPGA上校准数据不做上传下发，直接返回 */
            oam_warning_log1(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
                "hmac_send_cali_data::ch[%d] no cali data is delivered to host yet", uc_chan_idx);
            oal_netbuf_free(pst_netbuf_cali_data);
            return OAL_FAIL;
        }
        /*lint -e662*/
        puc_param = (uint8_t *)(&(pst_1105_cali_data->st_2gcali_param)) + l_remain_len;
        /*lint +e662*/
        while (l_remain_len > 0) {
            ret = hmac_post_cali_data_event(pst_mac_vap, pst_netbuf_cali_data, puc_param, &l_remain_len);
            if (ret != OAL_SUCC) {
                oal_netbuf_free(pst_netbuf_cali_data);
                return ret;
            }
        }
    }

    oam_info_log0(pst_mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "hmac_send_cali_data:end!");
    oal_netbuf_free(pst_netbuf_cali_data);

    return OAL_SUCC;
}

OAL_STATIC OAL_INLINE uint8_t hmac_get_rf_num(void)
{
    return g_wlan_spec_cfg->max_rf_num;
}

/*
 * 函 数 名  : hmac_set_2g_chn_cali_data
 * 功能描述  : 获取2g当前信道校准下发数据
 */
void hmac_set_2g_chn_cali_data(wlan_cali_data_para_stru *cali_data, uint8_t subband_idx,
    wlan_bandwidth_type_enum_uint8 bandwidth)
{
    wlan_cali_2g_20m_save_stru *cali_data_2g = NULL;
    uint8_t rf_idx;
    wlan_cali_2g_dbdc_para_stru *dbdc_data_2g = NULL;
    uint8_t rf_num = hmac_get_rf_num();
    uint8_t rf_slave_num = rf_num >> 1;

    for (rf_idx = 0; rf_idx < rf_num; rf_idx++) {
        cali_data_2g = &cali_data->rf_cali_data[rf_idx].cali_data_2g_20m;
        memcpy_s(&g_hmac_chn_cali_data.cali_data[rf_idx], sizeof(wlan_cali_basic_para_stru),
            &cali_data_2g->cali_data[subband_idx], sizeof(wlan_cali_basic_para_stru));
        if (rf_idx >= rf_slave_num) {
            dbdc_data_2g = &cali_data->dbdc_cali_data[rf_idx - rf_slave_num].cali_data_2g_dbdc;
            memcpy_s(&g_hmac_chn_cali_data.dbdc_cali_data[rf_idx - rf_slave_num],
                sizeof(wlan_cali_dbdc_basic_para_stru),
                &dbdc_data_2g->cali_data_20[subband_idx],
                sizeof(wlan_cali_dbdc_basic_para_stru));
        }
    }
}
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
/*
 * 函 数 名  : hmac_set_6g_chn_cali_data
 * 功能描述  : 获取6g当前信道校准下发数据
 */
void hmac_set_6g_chn_cali_data(wlan_cali_data_para_stru *cali_data, uint8_t subband_idx,
    wlan_bandwidth_type_enum_uint8 bandwidth)
{
    uint8_t rf_idx;
    wlan_cali_dbdc_basic_para_stru *dbdc_chn_cali_data = NULL;
    wlan_cali_basic_para_stru *chn_cali_data = NULL;
    wlan_cali_6g_dbdc_para_stru *cali_data_6g_dbdc = NULL;
    uint8_t rf_num = hmac_get_rf_num();
    uint8_t rf_slave_num = rf_num >> 1;

    for (rf_idx = 0; rf_idx < rf_num; rf_idx++) {
        if (bandwidth <= WLAN_BANDWIDTH_40) {
            chn_cali_data = &cali_data->rf_cali_data[rf_idx].cali_data_6g_20m.cali_data[subband_idx];
        } else if (bandwidth == WLAN_BANDWIDTH_80) {
            chn_cali_data = &cali_data->rf_cali_data[rf_idx].cali_data_6g_80m.cali_data[subband_idx];
        } else {
            chn_cali_data = &cali_data->rf_cali_data[rf_idx].cali_data_6g_160m.cali_data[subband_idx];
        }
        memcpy_s(&g_hmac_chn_cali_data.cali_data[rf_idx], sizeof(wlan_cali_basic_para_stru),
                 chn_cali_data, sizeof(wlan_cali_basic_para_stru));
        if (rf_idx >= rf_slave_num) {
            cali_data_6g_dbdc = &cali_data->dbdc_cali_data[rf_idx - rf_slave_num].cali_data_6g_dbdc;
            if (bandwidth <= WLAN_BANDWIDTH_40) {
                dbdc_chn_cali_data =
                    &cali_data_6g_dbdc->cali_data_20[subband_idx];
            } else if (bandwidth == WLAN_BANDWIDTH_80) {
                dbdc_chn_cali_data =
                    &cali_data_6g_dbdc->cali_data_80[subband_idx];
            } else {
                dbdc_chn_cali_data =
                    &cali_data_6g_dbdc->cali_data_160[subband_idx];
            }
            memcpy_s(&g_hmac_chn_cali_data.dbdc_cali_data[rf_idx - rf_slave_num],
                sizeof(wlan_cali_dbdc_basic_para_stru), dbdc_chn_cali_data, sizeof(wlan_cali_dbdc_basic_para_stru));
        }
    }
}
#endif

/*
 * 函 数 名  : hmac_set_5g_chn_cali_data
 * 功能描述  : 获取5g当前信道校准下发数据
 */
void hmac_set_5g_chn_cali_data(wlan_cali_data_para_stru *cali_data, uint8_t subband_idx,
    wlan_bandwidth_type_enum_uint8 bandwidth)
{
    uint8_t rf_idx;
    wlan_cali_dbdc_basic_para_stru *dbdc_chn_cali_data = NULL;
    wlan_cali_basic_para_stru *chn_cali_data = NULL;
    wlan_cali_5g_dbdc_para_stru *cali_data_5g_dbdc = NULL;
    uint8_t rf_num = hmac_get_rf_num();
    uint8_t rf_slave_num = rf_num >> 1;

    for (rf_idx = 0; rf_idx < rf_num; rf_idx++) {
        if (bandwidth <= WLAN_BANDWIDTH_40) {
            chn_cali_data = &cali_data->rf_cali_data[rf_idx].cali_data_5g_20m.cali_data[subband_idx];
        } else if (bandwidth == WLAN_BANDWIDTH_80) {
            chn_cali_data = &cali_data->rf_cali_data[rf_idx].cali_data_5g_80m.cali_data[subband_idx];
        } else {
            chn_cali_data = &cali_data->rf_cali_data[rf_idx].cali_data_5g_160m.cali_data[subband_idx];
        }
        memcpy_s(&g_hmac_chn_cali_data.cali_data[rf_idx], sizeof(wlan_cali_basic_para_stru),
                 chn_cali_data, sizeof(wlan_cali_basic_para_stru));
        if (rf_idx >= rf_slave_num) {
            cali_data_5g_dbdc = &cali_data->dbdc_cali_data[rf_idx - rf_slave_num].cali_data_5g_dbdc;
            if (bandwidth <= WLAN_BANDWIDTH_40) {
                dbdc_chn_cali_data =
                    &cali_data_5g_dbdc->cali_data_20[subband_idx];
            } else if (bandwidth == WLAN_BANDWIDTH_80) {
                dbdc_chn_cali_data =
                    &cali_data_5g_dbdc->cali_data_80[subband_idx];
            } else {
                dbdc_chn_cali_data =
                    &cali_data_5g_dbdc->cali_data_160[subband_idx];
            }

            memcpy_s(&g_hmac_chn_cali_data.dbdc_cali_data[rf_idx - rf_slave_num],
                sizeof(wlan_cali_dbdc_basic_para_stru), dbdc_chn_cali_data, sizeof(wlan_cali_dbdc_basic_para_stru));
        }
    }
}
/*
 * 函 数 名  : hmac_set_chn_cali_data
 * 功能描述  : 获取当前信道校准下发数据
 */
void hmac_set_chn_cali_data(wlan_cali_band_enum_uint8 wlan_cali_band, uint8_t subband_idx,
    wlan_bandwidth_type_enum_uint8 bandwidth)
{
    uint8_t *mem_addr = get_cali_data_buf_addr();
    wlan_cali_data_para_stru *cali_data = (wlan_cali_data_para_stru *)mem_addr;
    if (wlan_cali_band == WLAN_CALI_BAND_2G) {
        hmac_set_2g_chn_cali_data(cali_data, subband_idx, bandwidth);
    } else if (wlan_cali_band == WLAN_CALI_BAND_5G) {
        hmac_set_5g_chn_cali_data(cali_data, subband_idx, bandwidth);
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
    } else {
        hmac_set_6g_chn_cali_data(cali_data, subband_idx, bandwidth);
#endif
    }
}

/*
 * 函 数 名  : hmac_set_20m_basic_cali_data
 * 功能描述  : 获取20m带宽下所有信道相关校准数据
 */
void hmac_set_20m_basic_cali_data(wlan_cali_20m_basic_para_stru *cali_data_20m,
    wlan_cali_basic_para_stru *cali_data)
{
    memcpy_s(&cali_data_20m->rxdc_cali_data, sizeof(wlan_cali_rxdc_para_stru),
        &cali_data->rxdc_cali_data, sizeof(wlan_cali_rxdc_para_stru));
    memcpy_s(&cali_data_20m->txpwr_cali_data, sizeof(wlan_cali_txpwr_para_stru),
        &cali_data->txpwr_cali_data, sizeof(wlan_cali_txpwr_para_stru));
    /* tx相关参数只取0挡数据下发 */
    memcpy_s(&cali_data_20m->txdc_cali_data, sizeof(wlan_cali_txdc_para_stru),
        &cali_data->txdc_cali_data, sizeof(wlan_cali_txdc_para_stru));
}

/*
 * 函 数 名  : hmac_set_2g_20m_cali_data
 * 功能描述  : 获取2G 20m(扫描)校准下发数据
 */
void hmac_set_2g_20m_cali_data(wlan_cali_data_para_stru *cali_data)
{
    uint8_t rf_idx;
    int32_t ret = EOK;
    uint8_t chn_idx;
    wlan_cali_2g_20m_save_stru *cali_data_2g = NULL;
    wlan_cali_2g_20m_para_stru *cali_data_2g_20m = NULL;
    uint8_t rf_num = hmac_get_rf_num();

    for (rf_idx = 0; rf_idx < rf_num; rf_idx++) {
        cali_data_2g = &cali_data->rf_cali_data[rf_idx].cali_data_2g_20m;
        cali_data_2g_20m = &g_hmac_scan_all_ch_cali_data[rf_idx].cali_data_2g;
        for (chn_idx = 0; chn_idx < WLAN_2G_CALI_BAND_NUM; chn_idx++) {
            hmac_set_20m_basic_cali_data(&cali_data_2g_20m->chn_cali_data[chn_idx],
                &cali_data_2g->cali_data[chn_idx]);
        }
    }
    if (ret != EOK) {
        oam_error_log0(0, OAM_SF_ANY, "hmac_set_2g_20m_cali_data: memcopy fail!\n");
    }
}
/*
 * 函 数 名  : hmac_set_5g_20m_cali_data
 * 功能描述  : 获取5G 20m(扫描)校准下发数据
 */
void hmac_set_5g_20m_cali_data(wlan_cali_data_para_stru *cali_data)
{
    uint8_t rf_idx;
    uint8_t chn_idx;
    wlan_cali_5g_20m_save_stru *cali_data_5g = NULL;
    wlan_cali_5g_20m_para_stru *cali_data_5g_20m = NULL;
    uint8_t rf_num = hmac_get_rf_num();

    for (rf_idx = 0; rf_idx < rf_num; rf_idx++) {
        cali_data_5g = &cali_data->rf_cali_data[rf_idx].cali_data_5g_20m;
        cali_data_5g_20m = &g_hmac_scan_all_ch_cali_data[rf_idx].cali_data_5g;

        for (chn_idx = 0; chn_idx < WLAN_5G_20M_CALI_BAND_NUM; chn_idx++) {
            hmac_set_20m_basic_cali_data(&cali_data_5g_20m->chn_cali_data[chn_idx],
                &cali_data_5g->cali_data[chn_idx]);
        }
    }
}
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
/*
 * 函 数 名  : hmac_set_6g_20m_cali_data
 * 功能描述  : 获取6G 20m(扫描)校准下发数据
 */
void hmac_set_6g_20m_cali_data(wlan_cali_data_para_stru *cali_data)
{
    uint8_t rf_idx;
    uint8_t chn_idx;
    wlan_cali_6g_20m_save_stru *cali_data_6g = NULL;
    wlan_cali_6g_20m_para_stru *cali_data_6g_20m = NULL;
    uint8_t rf_num = hmac_get_rf_num();

    for (rf_idx = 0; rf_idx < rf_num; rf_idx++) {
        cali_data_6g = &cali_data->rf_cali_data[rf_idx].cali_data_6g_20m;
        cali_data_6g_20m = &g_hmac_scan_all_ch_cali_data[rf_idx].cali_data_6g;

        for (chn_idx = 0; chn_idx < WLAN_6G_20M_CALI_BAND_NUM; chn_idx++) {
            hmac_set_20m_basic_cali_data(&cali_data_6g_20m->chn_cali_data[chn_idx],
                &cali_data_6g->cali_data[chn_idx]);
        }
    }
}
#endif
/*
 * 函 数 名  : hmac_get_scan_basic_cali_data_addr
 * 功能描述  : 获取20m(扫描)校准信道数据地址
 */
wlan_cali_20m_basic_para_stru *hmac_get_scan_basic_cali_data_addr(uint8_t stream,
    wlan_cali_band_enum_uint8 wlan_cali_band, uint8_t chn_idx)
{
    switch (wlan_cali_band) {
        case WLAN_CALI_BAND_2G:
            return &g_hmac_scan_all_ch_cali_data[stream].cali_data_2g.chn_cali_data[chn_idx];
        case WLAN_CALI_BAND_5G:
            return &g_hmac_scan_all_ch_cali_data[stream].cali_data_5g.chn_cali_data[chn_idx];
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
        case WLAN_CALI_BAND_6G:
            return &g_hmac_scan_all_ch_cali_data[stream].cali_data_6g.chn_cali_data[chn_idx];
#endif
        default:
            oam_error_log1(0, OAM_SF_CALIBRATE,
                "hmac_get_2g_scan_basic_cali_data_addr fail::wlan_cali_band[%d].}", wlan_cali_band);
    }
    return NULL;
}
wlan_cali_dbdc_basic_para_stru *hmac_get_dbdc_basic_cali_data_addr(wlan_cali_data_para_stru *cali_data,
    uint8_t stream, wlan_cali_band_enum_uint8 wlan_cali_band, uint8_t chn_idx)
{
    switch (wlan_cali_band) {
        case WLAN_CALI_BAND_2G:
            return &cali_data->dbdc_cali_data[stream].cali_data_2g_dbdc.cali_data_20[chn_idx];
        case WLAN_CALI_BAND_5G:
            return &cali_data->dbdc_cali_data[stream].cali_data_5g_dbdc.cali_data_20[chn_idx];
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
        case WLAN_CALI_BAND_6G:
            return &cali_data->dbdc_cali_data[stream].cali_data_6g_dbdc.cali_data_20[chn_idx];
#endif
        default:
            oam_error_log1(0, OAM_SF_CALIBRATE,
                "hmac_get_dbdc_basic_cali_data_addr fail::wlan_cali_band[%d].}", wlan_cali_band);
    }
    return NULL;
}

/*
 * 函 数 名  : hmac_set_scan_dbdc_basic_cali_data
 * 功能描述  : 获取20m带宽下所有信道DBDC相关校准数据
 */
void hmac_set_scan_dbdc_basic_cali_data(wlan_cali_20m_basic_para_stru *cali_data_20m,
    wlan_cali_dbdc_basic_para_stru *cali_data)
{
    if (cali_data_20m == NULL || cali_data == NULL) {
        return;
    }
    memcpy_s(&cali_data_20m->rxdc_cali_data, sizeof(wlan_cali_rxdc_para_stru),
        &cali_data->rxdc_cali_data, sizeof(wlan_cali_rxdc_para_stru));
    memcpy_s(&cali_data_20m->txpwr_cali_data, sizeof(wlan_cali_txpwr_para_stru),
        &cali_data->txpwr_cali_data, sizeof(wlan_cali_txpwr_para_stru));
    memcpy_s(&cali_data_20m->txdc_cali_data, sizeof(wlan_cali_txdc_para_stru),
        &cali_data->txdc_cali_data, sizeof(wlan_cali_txdc_para_stru));
}
/*
 * 函 数 名  : hmac_set_scan_dbdc_cali_data
 * 功能描述  : 获取20m(扫描)下发DBDC校准数据
 */
void hmac_set_scan_dbdc_cali_data(void)
{
    uint8_t *mem_addr = get_cali_data_buf_addr();
    wlan_cali_data_para_stru *cali_data = (wlan_cali_data_para_stru *)mem_addr;
    uint8_t rf_idx;
    uint8_t chn_idx;
    wlan_cali_band_enum_uint8 wlan_cali_band;
    uint8_t rf_num = hmac_get_rf_num();
    uint8_t rf_slave_num = rf_num >> BIT_OFFSET_1;
    wlan_cali_20m_basic_para_stru *scan_cali_data = NULL;
    wlan_cali_dbdc_basic_para_stru *dbdc_cali_data = NULL;
    uint8_t chn_num[] = {WLAN_2G_CALI_BAND_NUM, WLAN_5G_20M_CALI_BAND_NUM, WLAN_6G_20M_CALI_BAND_NUM};

    for (rf_idx = rf_slave_num; rf_idx < rf_num; rf_idx++) {
        for (wlan_cali_band = WLAN_CALI_BAND_2G; wlan_cali_band < WLAN_CALI_BAND_BUTT; wlan_cali_band++) {
            for (chn_idx = 0; chn_idx < chn_num[wlan_cali_band]; chn_idx++) {
                scan_cali_data = hmac_get_scan_basic_cali_data_addr(rf_idx, wlan_cali_band, chn_idx);
                dbdc_cali_data = hmac_get_dbdc_basic_cali_data_addr(cali_data,
                    rf_idx - rf_slave_num, wlan_cali_band, chn_idx);
                hmac_set_scan_dbdc_basic_cali_data(scan_cali_data, dbdc_cali_data);
            }
        }
    }
}

/*
 * 函 数 名  : hmac_set_scan_cali_data
 * 功能描述  : 获取20m(扫描)校准下发数据
 */
void hmac_set_scan_cali_data(mac_vap_stru *mac_vap)
{
    uint8_t *mem_addr = get_cali_data_buf_addr();
    wlan_cali_data_para_stru *cali_data = (wlan_cali_data_para_stru *)mem_addr;

    hmac_set_2g_20m_cali_data(cali_data);
    hmac_set_5g_20m_cali_data(cali_data);
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
    hmac_set_6g_20m_cali_data(cali_data);
#endif
    memcpy_s(&g_hmac_20m_cali_common_data.common_cali_data, sizeof(wlan_cali_common_para_stru),
        &cali_data->common_cali_data, sizeof(wlan_cali_common_para_stru));
    g_hmac_20m_cali_common_data.cur_cali_policy = cali_data->common_cali_data.cali_ctl_data.cur_cali_policy;
#if (_PRE_OS_VERSION_LINUX == _PRE_OS_VERSION)
    g_hmac_20m_cali_common_data.cali_cnt = g_custom_cali_cnt;
#endif
}
void hmac_send_dbdc_scan_cali_data_shenkuo(mac_vap_stru *mac_vap, oal_bool_enum_uint8 dbdc_running)
{
    h2d_cali_trans_stru h2d_scan_cali_trans = {0};
    hmac_set_scan_cali_data(mac_vap);

    /* dbdc开启后下发dbdc扫描校准数据 */
    if (dbdc_running) {
        hmac_set_scan_dbdc_cali_data();
    }

    h2d_scan_cali_trans.cali_data_type = WLAN_SCAN_ALL_CHN;
    hmac_send_cali_data_shenkuo(mac_vap, &h2d_scan_cali_trans);
}

/*
 * 函 数 名  : hmac_set_5g_20m_cali_data
 * 功能描述  获取校准数据长度
 */
int32_t hmac_get_cali_data_send_len(h2d_cali_trans_stru *h2d_cali_trans)
{
    uint8_t rf_num = hmac_get_rf_num();
    uint32_t data_len = 0;

    switch (h2d_cali_trans->cali_data_type) {
        case WLAN_CURRENT_WORK_CHN:
            data_len =  sizeof(wlan_cali_chn_stru);
            break;
        case WLAN_SCAN_ALL_CHN:
            data_len =  sizeof(wlan_cali_rf_20m_para_stru) * rf_num;
            break;
        case WLAN_CALI_CTL:
            data_len =  sizeof(wlan_cali_data_20m_common_para_stru);
            break;
        default:
             oam_error_log1(0, OAM_SF_CALIBRATE,
                 "hmac_get_cali_data_send_len fail::cali_data_type[%d].}", h2d_cali_trans->cali_data_type);
            break;
    }
    return (int32_t)data_len;
}
/*
 * 函 数 名  : hmac_set_5g_20m_cali_data
 * 功能描述  : 获取5G 20m(扫描)校准下发数据
 */
uint8_t *hmac_get_cali_data_send_addr(h2d_cali_trans_stru *h2d_cali_trans)
{
    uint8_t *data_addr = NULL;

    switch (h2d_cali_trans->cali_data_type) {
        case WLAN_CURRENT_WORK_CHN:
            data_addr = (uint8_t *)(&g_hmac_chn_cali_data);
            break;
        case WLAN_SCAN_ALL_CHN:
            data_addr = (uint8_t *)(&g_hmac_scan_all_ch_cali_data[0]);
            break;
        case WLAN_CALI_CTL:
            data_addr = (uint8_t *)(&g_hmac_20m_cali_common_data);
            break;
        default:
            oam_error_log1(0, OAM_SF_CALIBRATE,
                "hmac_get_cali_data_send_addr fail::cali_data_type[%d].}", h2d_cali_trans->cali_data_type);
            break;
    }
    return data_addr;
}

/*
 * 函 数 名  : hmac_post_cali_data_event_shenkuo
 * 功能描述  : 校准数据下发抛事件
 */
static uint32_t hmac_post_cali_data_event_shenkuo(mac_vap_stru *mac_vap, oal_netbuf_stru *netbuf,
    uint8_t *cali_data, int32_t *remain_len, h2d_cali_trans_stru *h2d_cali_trans)
{
    frw_event_mem_stru *evt_mem = NULL;
    frw_event_stru *evt = NULL;
    dmac_tx_event_stru *cali_data_evt = NULL;
    uint32_t ret;
    uint16_t trans_len;

    evt_mem = frw_event_alloc_m(sizeof(dmac_tx_event_stru));
    if (evt_mem == NULL) {
        oam_error_log0(mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "{hmac_post_cali_data_event_shenkuo::event_mem null.}");
        return OAL_ERR_CODE_PTR_NULL;
    }

    evt = frw_get_event_stru(evt_mem);
    frw_event_hdr_init(&(evt->st_event_hdr),
        FRW_EVENT_TYPE_WLAN_CTX, DMAC_WLAN_CTX_EVENT_SUB_TYPE_CALI_HMAC2DMAC,
        sizeof(dmac_tx_event_stru), FRW_EVENT_PIPELINE_STAGE_1,
        mac_vap->uc_chip_id, mac_vap->uc_device_id, mac_vap->uc_vap_id);

    memset_s(oal_netbuf_cb(netbuf), OAL_TX_CB_LEN, 0, OAL_TX_CB_LEN);

    /* netbuf len 不能超过1544字节 */
    trans_len = (uint16_t)oal_min(WLAN_LARGE_NETBUF_SIZE - HMAC_NETBUF_REMAIN_MAX_DIFF_LEN,
        *remain_len + sizeof(h2d_cali_trans_stru));
    h2d_cali_trans->curr_send_data_len = (int32_t)trans_len - (int32_t)sizeof(h2d_cali_trans_stru); // 实际校准数据的长度

    /*lint -e662*/
    ret = (uint32_t)memcpy_s(oal_netbuf_data(netbuf), WLAN_LARGE_NETBUF_SIZE,
        h2d_cali_trans, sizeof(h2d_cali_trans_stru));
    ret += (uint32_t)memcpy_s(oal_netbuf_data(netbuf) + sizeof(h2d_cali_trans_stru),
        WLAN_LARGE_NETBUF_SIZE - sizeof(h2d_cali_trans_stru),
        cali_data - *remain_len, (uint32_t)h2d_cali_trans->curr_send_data_len);
    if (ret != EOK) {
        oam_error_log0(mac_vap->uc_vap_id, OAM_SF_CALIBRATE, "hmac_post_cali_data_event_shenkuo::memcpy fail!");
        frw_event_free_m(evt_mem);
        return OAL_FAIL;
    }

    /*lint +e662*/
    cali_data_evt = (dmac_tx_event_stru *)evt->auc_event_data;
    cali_data_evt->pst_netbuf = netbuf;
    cali_data_evt->us_frame_len = trans_len;
    cali_data_evt->us_remain = (uint16_t)*remain_len;
    *remain_len -= h2d_cali_trans->curr_send_data_len;

    ret = frw_event_dispatch_event(evt_mem);
    if (oal_unlikely(ret != OAL_SUCC)) {
        oam_error_log3(mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_post_cali_data_event_shenkuo::dispatch event fail ret[%d], remain_len[%d] trans_len[%d].}",
            ret, *remain_len, trans_len);
    }

    frw_event_free_m(evt_mem);
    return ret;
}
uint32_t hmac_send_cali_data_shenkuo(mac_vap_stru *mac_vap, h2d_cali_trans_stru *h2d_cali_trans)
{
    oal_netbuf_stru            *netbuf = NULL;
    uint8_t                    *param = NULL;
    uint32_t                   ret;
    int32_t                    remain_len;
#ifndef _PRE_EMU
    param = hmac_get_cali_data_send_addr(h2d_cali_trans);
    remain_len = hmac_get_cali_data_send_len(h2d_cali_trans);
    if (param == NULL || remain_len == 0) {
        return OAL_FAIL;
    }
    h2d_cali_trans->cali_data_total_len = remain_len;
    param += remain_len;

    netbuf = oal_mem_netbuf_alloc(OAL_NORMAL_NETBUF, WLAN_LARGE_NETBUF_SIZE, OAL_NETBUF_PRIORITY_MID);
    if (netbuf == NULL) {
        oam_error_log1(mac_vap->uc_vap_id, OAM_SF_CALIBRATE,
            "{hmac_send_cali_data_shenkuo::pst_netbuf alloc null SIZE[%d].}", WLAN_LARGE_NETBUF_SIZE);
        return OAL_ERR_CODE_ALLOC_MEM_FAIL;
    }
    while (remain_len > 0) {
        ret = hmac_post_cali_data_event_shenkuo(mac_vap, netbuf, param, &remain_len, h2d_cali_trans);
        if (ret != OAL_SUCC) {
            oal_netbuf_free(netbuf);
            return ret;
        }
    }

    oal_netbuf_free(netbuf);
#endif
    return OAL_SUCC;
}
uint32_t hmac_get_center_freq_chan_num(uint8_t uc_chan_number,
    wlan_channel_bandwidth_enum_uint8 en_bandwidth,
    uint8_t *puc_center_freq_chn)
{
    int16_t s_center_chan_idx;

    /* channel number to center channel idx map
    BAND WIDTH                            CENTER CHAN INDEX:

    WLAN_BAND_WIDTH_20M                   chan_num
    WLAN_BAND_WIDTH_40PLUS                chan_num + 2
    WLAN_BAND_WIDTH_40MINUS               chan_num - 2
    WLAN_BAND_WIDTH_80PLUSPLUS            chan_num + 6
    WLAN_BAND_WIDTH_80PLUSMINUS           chan_num - 2
    WLAN_BAND_WIDTH_80MINUSPLUS           chan_num + 2
    WLAN_BAND_WIDTH_80MINUSMINUS          chan_num - 6
    WLAN_BAND_WIDTH_160PLUSPLUSPLUS       chan_num + 14
    WLAN_BAND_WIDTH_160MINUSPLUSPLUS      chan_num + 10
    WLAN_BAND_WIDTH_160PLUSMINUSPLUS      chan_num + 6
    WLAN_BAND_WIDTH_160MINUSMINUSPLUS     chan_num + 2
    WLAN_BAND_WIDTH_160PLUSPLUSMINUS      chan_num - 2
    WLAN_BAND_WIDTH_160MINUSPLUSMINUS     chan_num - 6
    WLAN_BAND_WIDTH_160PLUSMINUSMINUS     chan_num - 10
    WLAN_BAND_WIDTH_160MINUSMINUSMINUS    chan_num - 14
    ********************************************************/
    int8_t ac_center_chan_offset[WLAN_BAND_WIDTH_BUTT - 2] = { // 2代表减去40m、80m带宽枚举
        0, 2, -2, 6, -2, 2, -6,
#ifdef _PRE_WLAN_FEATURE_160M
        14, -2, 6, -10, 10, -6, 2, -14
#endif
    };

    if (en_bandwidth >= WLAN_BAND_WIDTH_BUTT - 2) { // 2代表减去40m、80m带宽枚举
        return OAL_FAIL;
    }

    s_center_chan_idx = ac_center_chan_offset[en_bandwidth] + (int8_t)uc_chan_number;
    if (s_center_chan_idx < 0) {
        return OAL_FAIL;
    }

    *puc_center_freq_chn = (uint8_t)s_center_chan_idx;

    return OAL_SUCC;
}
/*
 函 数 名  : hmac_get_center_freq_from_freq_chnnum
 功能描述  : 获取当前信道的对应频点
*/
static uint16_t hmac_get_center_freq_from_freq_chnnum(mac_channel_stru *channel_info)
{
    uint16_t center_freq;

    if (channel_info->en_band == WLAN_BAND_2G) {
        center_freq = wlan_get_center_freq_2g(channel_info);
    } else {
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
        if (channel_info->ext6g_band) {
            center_freq = wlan_get_center_freq_6g(channel_info);
        } else {
#endif
            center_freq = wlan_get_center_freq_5g(channel_info);
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
        }
#endif
    }
    return center_freq;
}
void hmac_cali_send_work_channel_cali_data(mac_vap_stru *mac_vap)
{
    mac_device_stru *mac_dev = NULL;
    cali_data_req_stru cali_data_req_info;

    mac_dev = mac_res_get_dev(mac_vap->uc_device_id);
    if (mac_dev == NULL) {
        oam_error_log1(mac_vap->uc_vap_id, OAM_SF_CFG,
            "{hmac_cali_send_work_channel_cali_data::dev[%d] ptr is null}", mac_vap->uc_device_id);
        return;
    }
    cali_data_req_info.channel = mac_vap->st_channel;
    cali_data_req_info.mac_vap_id = mac_vap->uc_vap_id;
    cali_data_req_info.work_cali_data_sub_type = CALI_DATA_NORMAL_JOIN_TYPE;

    wlan_chip_update_cur_chn_cali_data(&cali_data_req_info);
}
/*
 * 函 数 名  : hmac_update_single_chn_cali_data
 * 功能描述  : 根据信道信息更新当前信道校准数据
 */
void hmac_update_single_chn_cali_data(cali_data_req_stru *cali_data_req_info, uint8_t subband_idx,
    wlan_bandwidth_type_enum_uint8 cali_bandwidth, wlan_cali_band_enum_uint8 wlan_cali_band)
{
#if (_PRE_OS_VERSION_LINUX == _PRE_OS_VERSION)
    uint32_t ret;
    h2d_cali_trans_stru h2d_cali_trans = {0};
    uint16_t center_freq = hmac_get_center_freq_from_freq_chnnum(&cali_data_req_info->channel);
    mac_vap_stru *mac_vap = mac_res_get_mac_vap(cali_data_req_info->mac_vap_id);
    if (mac_vap == NULL) {
        oam_error_log0(0, 0, "{hmac_update_single_chn_cali_data::mac_vap is NULL}");
        return;
    }

    h2d_cali_trans.band = wlan_cali_band;
    h2d_cali_trans.bandwidth = cali_bandwidth;
    h2d_cali_trans.subband_idx = subband_idx;
    h2d_cali_trans.center_freq = center_freq;
    h2d_cali_trans.cali_data_type = WLAN_CURRENT_WORK_CHN;
    h2d_cali_trans.cali_data_subtype = cali_data_req_info->work_cali_data_sub_type;

    hmac_set_chn_cali_data(wlan_cali_band, subband_idx, cali_bandwidth);

    ret = hmac_send_cali_data_shenkuo(mac_vap, &h2d_cali_trans);
    if (ret != OAL_SUCC) {
        oam_warning_log1(mac_vap->uc_vap_id, 0, "{hmac_update_single_chn_cali_data::send cali data fail,data type[%d]}",
            cali_data_req_info->work_cali_data_sub_type);
    }
#endif
}
void hmac_update_2g_all_band_cali_data(cali_data_req_stru *cali_data_req_info)
{
    uint8_t subband_idx;
    uint16_t center_freq = hmac_get_center_freq_from_freq_chnnum(&cali_data_req_info->channel);
    uint8_t curr_subband_idx = wlan_rf_cali_div_cali_2g_band_idx(WLAN_RF_CALI_TX_PWR, WLAN_BANDWIDTH_40, center_freq);
    hmac_update_single_chn_cali_data(cali_data_req_info, curr_subband_idx, WLAN_BANDWIDTH_40, WLAN_CALI_BAND_2G);

    /* 2g 3个band的所有校准数据 */
    for (subband_idx = 0; subband_idx < WLAN_2G_CALI_BAND_NUM; subband_idx++) {
        if (subband_idx == curr_subband_idx) {
            continue;
        }
        hmac_update_single_chn_cali_data(cali_data_req_info, subband_idx, WLAN_BANDWIDTH_40, WLAN_CALI_BAND_2G);
    }
}
void hmac_update_5g_cur_band_cali_data_shenkuo(cali_data_req_stru *cali_data_req_info)
{
    wlan_bandwidth_type_enum_uint8 cali_bandwidth;
    wlan_bandwidth_type_enum_uint8 curr_cali_bandwidth = hmac_cali_get_wlan_bandwidth(&cali_data_req_info->channel);
    uint16_t center_freq = hmac_get_center_freq_from_freq_chnnum(&cali_data_req_info->channel);
    uint8_t subband_idx;
    mac_channel_stru channel_temp = { 0 };

    subband_idx = wlan_rf_cali_div_cali_5g_band_idx(WLAN_RF_CALI_TX_PWR, curr_cali_bandwidth, center_freq);
    /* 20M、40M共用一份校准数据下发 */
    curr_cali_bandwidth = curr_cali_bandwidth >= WLAN_BANDWIDTH_40 ? curr_cali_bandwidth : WLAN_BANDWIDTH_40;
    hmac_update_single_chn_cali_data(cali_data_req_info, subband_idx, curr_cali_bandwidth, WLAN_CALI_BAND_5G);
    /* 160M跨了两个80M band,需要根据chan num 20M的中心频点去取对应80M的band */
    if (curr_cali_bandwidth == WLAN_BANDWIDTH_160) {
        channel_temp.uc_chan_number = cali_data_req_info->channel.uc_chan_number;
        channel_temp.en_bandwidth = WLAN_BAND_WIDTH_20M;
        center_freq = hmac_get_center_freq_from_freq_chnnum(&channel_temp);
    }
    /* 5G当前信道所在band的所有支持带宽都下发 */
    for (cali_bandwidth = WLAN_BANDWIDTH_40; cali_bandwidth <= WLAN_BANDWIDTH_160; cali_bandwidth++) {
        if (cali_bandwidth == curr_cali_bandwidth) {
            continue;
        }
        subband_idx = wlan_rf_cali_div_cali_5g_band_idx(WLAN_RF_CALI_TX_PWR, cali_bandwidth, center_freq);
        hmac_update_single_chn_cali_data(cali_data_req_info, subband_idx, cali_bandwidth, WLAN_CALI_BAND_5G);
    }
}
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
void hmac_update_6g_cur_band_cali_data_shenkuo(cali_data_req_stru *cali_data_req_info)
{
    uint8_t subband_idx;
    wlan_bandwidth_type_enum_uint8 cali_bandwidth;
    wlan_bandwidth_type_enum_uint8 curr_cali_bandwidth = hmac_cali_get_wlan_bandwidth(&cali_data_req_info->channel);
    uint16_t center_freq = hmac_get_center_freq_from_freq_chnnum(&cali_data_req_info->channel);
    mac_channel_stru channel_temp = { 0 };
    subband_idx = wlan_rf_cali_div_cali_6g_band_idx(WLAN_RF_CALI_TX_PWR, curr_cali_bandwidth, center_freq);
    /* 20M、40M共用一份校准数据下发 */
    curr_cali_bandwidth = curr_cali_bandwidth >= WLAN_BANDWIDTH_40 ? curr_cali_bandwidth : WLAN_BANDWIDTH_40;
    hmac_update_single_chn_cali_data(cali_data_req_info, subband_idx, curr_cali_bandwidth, WLAN_CALI_BAND_6G);
    /* 160M跨了两个80M band,需要根据chan num 20M的中心频点去取对应80M的band */
    if (curr_cali_bandwidth == WLAN_BANDWIDTH_160) {
        channel_temp.uc_chan_number = cali_data_req_info->channel.uc_chan_number;
        channel_temp.en_bandwidth = WLAN_BAND_WIDTH_20M;
        center_freq = hmac_get_center_freq_from_freq_chnnum(&channel_temp);
    }
    /* 6G当前信道所在band的所有支持带宽都下发 */
    for (cali_bandwidth = WLAN_BANDWIDTH_40; cali_bandwidth <= WLAN_BANDWIDTH_160; cali_bandwidth++) {
        if (cali_bandwidth == curr_cali_bandwidth) {
            continue;
        }
        subband_idx = wlan_rf_cali_div_cali_6g_band_idx(WLAN_RF_CALI_TX_PWR, cali_bandwidth, center_freq);
        hmac_update_single_chn_cali_data(cali_data_req_info, subband_idx, cali_bandwidth, WLAN_CALI_BAND_6G);
    }
}
#endif
/*
 * 函 数 名   : hmac_rf_cali_get_wlan_bandwidth
 * 功能描述   : 从plusplus...识别20M 40M 80M 160M
 */
wlan_bandwidth_type_enum_uint8 hmac_cali_get_wlan_bandwidth(mac_channel_stru *chn_para)
{
    if (chn_para->en_bandwidth == WLAN_BAND_WIDTH_20M) {
        return WLAN_BANDWIDTH_20;
    } else if (chn_para->en_bandwidth <= WLAN_BAND_WIDTH_40MINUS || WLAN_BAND_WIDTH_40M == chn_para->en_bandwidth) {
        return WLAN_BANDWIDTH_40;
    } else if (chn_para->en_bandwidth <= WLAN_BAND_WIDTH_80MINUSMINUS ||
               WLAN_BAND_WIDTH_80M == chn_para->en_bandwidth) {
        return WLAN_BANDWIDTH_80;
#ifdef _PRE_WLAN_FEATURE_160M
    } else if (chn_para->en_bandwidth <= WLAN_BAND_WIDTH_160MINUSMINUSMINUS) {
        return WLAN_BANDWIDTH_160;
#endif
    } else {
        return WLAN_BANDWIDTH_20;
    }
}
static uint8_t hmac_cali_get_band_idx(mac_channel_stru *chn_para)
{
    uint16_t center_freq = hmac_get_center_freq_from_freq_chnnum(chn_para);
    wlan_bandwidth_type_enum_uint8 bw_cap = hmac_cali_get_wlan_bandwidth(chn_para);

    if (chn_para->en_band == WLAN_BAND_2G) {
        return wlan_rf_cali_div_cali_2g_band_idx(WLAN_RF_CALI_TX_PWR, bw_cap, center_freq);
    } else {
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
        if (chn_para->ext6g_band) {
            return wlan_rf_cali_div_cali_6g_band_idx(WLAN_RF_CALI_TX_PWR, bw_cap, center_freq);
        }
#endif
        return wlan_rf_cali_div_cali_5g_band_idx(WLAN_RF_CALI_TX_PWR, bw_cap, center_freq);
    }
}
static void hmac_update_csa_channel_cali_data(cali_data_req_stru *cali_data_req_info)
{
    uint8_t band;
    uint8_t subband_idx;
    wlan_bandwidth_type_enum_uint8 cali_bandwidth;

    band = wlan_get_cali_band(&cali_data_req_info->channel);
    subband_idx = hmac_cali_get_band_idx(&cali_data_req_info->channel);
    cali_bandwidth = hmac_cali_get_wlan_bandwidth(&cali_data_req_info->channel);
    cali_bandwidth = cali_bandwidth >= WLAN_BANDWIDTH_40 ? cali_bandwidth : WLAN_BANDWIDTH_40;
    hmac_update_single_chn_cali_data(cali_data_req_info, subband_idx, cali_bandwidth, band);
}
/*
 * 函 数 名  : hmac_update_cur_chn_cali_data_shenkuo
 * 功能描述  : 根据信道信息更新当前信道校准数据
 */
void hmac_update_cur_chn_cali_data_shenkuo(cali_data_req_stru *cali_data_req_info)
{
    wlan_cali_band_enum_uint8 wlan_cali_band = wlan_get_cali_band(&cali_data_req_info->channel);

    /* 1、csa type只下发当前所需要的bw,待csa结束后释放old的3个bw补充new的 */
    if (cali_data_req_info->work_cali_data_sub_type == CALI_DATA_CSA_TYPE) {
        hmac_update_csa_channel_cali_data(cali_data_req_info);
        return;
    }
    /* 2、normal join需要多下发 */
    if (wlan_cali_band == WLAN_CALI_BAND_2G) {
        hmac_update_2g_all_band_cali_data(cali_data_req_info);
    } else if (wlan_cali_band == WLAN_CALI_BAND_5G) {
        hmac_update_5g_cur_band_cali_data_shenkuo(cali_data_req_info);
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
    } else if (wlan_cali_band == WLAN_CALI_BAND_6G) {
        hmac_update_6g_cur_band_cali_data_shenkuo(cali_data_req_info);
#endif
    }
}
static void hmac_save_cali_data_end(uint16_t *cali_times)
{
    hmac_first_powon_cali_completed();

    (*cali_times)++;
    g_cali_update_channel_info = (uint32_t)(*cali_times);

    oam_info_log1(0, OAM_SF_CALIBRATE, "{hmac_save_cali_data_end::last packet cali_time %d}", (*cali_times));
}
/*
 * 函 数 名  : hmac_first_powon_cali_completed
 * 功能描述  : 开机上电校准完成信号量更新
 */
void hmac_first_powon_cali_completed(void)
{
    if (hmac_get_wlan_first_power_on_cali_flag() == OAL_TRUE) {
        oal_complete(hmac_get_wlan_cali_completed_addr());
        oam_warning_log0(0, OAM_SF_CALIBRATE, "{hmac_save_cali_data_end:power on,cali and power off completed!}");
    }
}

uint32_t hmac_save_cali_event_1103(frw_event_mem_stru *event_mem)
{
    frw_event_stru                  *event = NULL;
    hal_cali_hal2hmac_event_stru    *cali_save_event = NULL;
    hal_cali_hal2hmac_payload_stru  *payload = NULL;
    uint8_t                       *start_addr = NULL;
    uint32_t                       copy_len, remain_len, frame_len, cali_data_size;
    uint16_t                      *cali_times = NULL;
    hi1103_cali_param_stru          *cali_data = NULL;
    OAL_STATIC uint32_t            cali_data_len = 0;

    cali_data = (hi1103_cali_param_stru *)get_cali_data_buf_addr();
    if (cali_data == NULL) {
        return OAL_ERR_CODE_PTR_NULL; // coverity err 61 fix
    }

    cali_data_size = RF_CALI_DATA_BUF_LEN;
    /* 通道1的校准数据 */
    if (cali_data_len >= RF_SINGLE_CHAN_CALI_DATA_BUF_LEN) {
        cali_data++;
        remain_len  = cali_data_size - cali_data_len;
    } else {
        remain_len  = (cali_data_size >> BIT_OFFSET_1) - cali_data_len;
    }

    event = frw_get_event_stru(event_mem);
    cali_save_event = (hal_cali_hal2hmac_event_stru *)event->auc_event_data;
    payload = (hal_cali_hal2hmac_payload_stru *)oal_netbuf_data(cali_save_event->pst_netbuf);

    frame_len = oal_netbuf_len(cali_save_event->pst_netbuf) - sizeof(payload->packet_idx);

    oam_info_log1(0, OAM_SF_CALIBRATE, "hmac_save_cali_event:packet_idx %d", payload->packet_idx);

    start_addr = (uint8_t *)(&cali_data->ast_2gcali_param) + (frame_len * payload->packet_idx);

    copy_len = oal_min(remain_len, frame_len);
    oam_info_log2(0, OAM_SF_CALIBRATE, "hmac_save_cali_event:remain len[%d] frame len[%d]!", remain_len, frame_len);

    cali_data_len += copy_len;

    if (cali_data_size == cali_data_len) {
        cali_times = &cali_data->st_cali_update_info.cali_time;
        hmac_save_cali_data_end(cali_times);
    }

    if (EOK != memcpy_s(start_addr, remain_len, payload->auc_payoald, copy_len)) {
        oam_error_log0(0, OAM_SF_ANY, "hmac_save_cali_event::memcpy fail!");
        oal_netbuf_free(cali_save_event->pst_netbuf);
        return OAL_FAIL;
    }

    if (cali_data_size == cali_data_len) {
        cali_data_len = 0;
        hmac_dump_cali_result();
    }

    hmac_get_cali_data_for_bt20dbm();

    oal_netbuf_free(cali_save_event->pst_netbuf);
    return OAL_SUCC;
}

uint32_t hmac_save_cali_event_1105(frw_event_mem_stru *event_mem)
{
    frw_event_stru                  *event = NULL;
    hal_cali_hal2hmac_event_stru    *cali_save_event = NULL;
    hal_cali_hal2hmac_payload_stru  *payload = NULL;
    uint8_t                       *start_addr = NULL;
    uint32_t                       copy_len, remain_len, frame_len, cali_data_size;
    uint16_t                      *cali_times = NULL;
    hi1105_cali_param_stru          *cali_data = NULL;
    OAL_STATIC uint32_t            cali_data_len = 0;

    cali_data = (hi1105_cali_param_stru *)get_cali_data_buf_addr();
    if (cali_data == NULL) {
        return OAL_ERR_CODE_PTR_NULL;
    }

    event = frw_get_event_stru(event_mem);
    cali_save_event  = (hal_cali_hal2hmac_event_stru *)event->auc_event_data;
    payload = (hal_cali_hal2hmac_payload_stru *)oal_netbuf_data(cali_save_event->pst_netbuf);

    cali_data_size = HI1105_CALI_DATA_BUF_LEN - (sizeof(cali_data->dog_tag) << BIT_OFFSET_1);

    if (payload->packet_idx == 0 &&
        (!(cali_data_len == (cali_data_size >> BIT_OFFSET_1) || (cali_data_len == 0)))) {
        cali_data_len = 0;
    }

    /* 通道1的校准数据 */
    if ((HI1105_SINGLE_CHAN_CALI_DATA_BUF_LEN - sizeof(cali_data->dog_tag)) <= cali_data_len) {
        cali_data++;
        remain_len  = cali_data_size - cali_data_len;
    } else {
        remain_len  = (cali_data_size >> BIT_OFFSET_1) - cali_data_len;
    }

    frame_len = oal_netbuf_len(cali_save_event->pst_netbuf) - sizeof(payload->packet_idx);
    start_addr = (uint8_t *)(&cali_data->st_2gcali_param) + (frame_len * payload->packet_idx);
    copy_len = oal_min(remain_len, frame_len);
    cali_data_len += copy_len;

    if (cali_data_size == cali_data_len) {
        cali_times = &cali_data->st_cali_update_info.us_cali_time;
        hmac_save_cali_data_end(cali_times);
    }

    if (EOK != memcpy_s(start_addr, remain_len, payload->auc_payoald, copy_len)) {
        oam_error_log0(0, OAM_SF_ANY, "hmac_save_cali_event::memcpy fail!");
        oal_netbuf_free(cali_save_event->pst_netbuf);
        return OAL_FAIL;
    }

    if (cali_data_size == cali_data_len) {
        cali_data_len = 0;
        hmac_dump_cali_result_1105();
    }

    hmac_get_1105_cali_data_for_bt20dbm();

    oal_netbuf_free(cali_save_event->pst_netbuf);
    return OAL_SUCC;
}

static void hmac_send_cali_data_event(mac_vap_stru *mac_vap, uint16_t *cali_times,
    wlan_d2h_cali_data_type_enum_uint8 data_type)
{
    wlan_bus_type_enum_uint8 bus_type = WLAN_BUS_SDIO;

    if (data_type == WLAN_CALI_DATA_COMMON) {
        hmac_save_cali_data_end(cali_times);
        return;
    }

    hmac_send_custom_data(mac_vap, sizeof(wlan_bus_type_enum_uint8), (uint8_t *)&bus_type, WLAN_CFGID_SET_RF_CALI_RUN);
}

uint32_t hmac_get_cali_data_size(wlan_d2h_cali_data_type_enum_uint8 data_type)
{
    uint8_t data_idx;
    uint32_t data_size[WLAN_CALI_DATA_C0_BUTT] = {
        sizeof(wlan_cali_2g_20m_save_stru), 0, sizeof(wlan_cali_5g_20m_save_stru), 0,
        sizeof(wlan_cali_5g_80m_save_stru), sizeof(wlan_cali_5g_160m_save_stru),
#ifdef _PRE_WLAN_FEATURE_6G_EXTEND
        sizeof(wlan_cali_6g_20m_save_stru), 0, sizeof(wlan_cali_6g_80m_save_stru), sizeof(wlan_cali_6g_160m_save_stru),
#else
        0, 0, 0, 0,
#endif
    };
    if (data_type < WLAN_CALI_DATA_DBDC) {
        data_idx = data_type % (WLAN_CALI_DATA_C0_BUTT);
        return data_size[data_idx];
    }
    if (data_type == WLAN_CALI_DATA_DBDC) {
        return sizeof(wlan_cali_dbdc_para_stru) * HD_EVENT_SLAVE_RF_NUM;
    }
    if (data_type == WLAN_CALI_DATA_COMMON) {
        return sizeof(wlan_cali_common_para_stru);
    }

    return 0;
}
uint8_t *hmac_get_cali_data_save_addr(uint8_t *cali_data,
    wlan_d2h_cali_data_type_enum_uint8 data_type)
{
    wlan_d2h_cali_data_type_enum_uint8 data_idx;
    uint32_t addr_offset = 0;

    for (data_idx = 0; data_idx < data_type; data_idx++) {
        addr_offset += hmac_get_cali_data_size(data_idx);
    }

    return cali_data + addr_offset;
}

uint32_t hmac_save_cali_event_shenkuo(frw_event_mem_stru *event_mem)
{
    frw_event_stru                 *event = frw_get_event_stru(event_mem);
    hal_cali_hal2hmac_event_stru   *cali_save_event = NULL;
    hal_cali_hal2hmac_payload_stru *payload = NULL;
    OAL_STATIC uint8_t             *dest_addr = NULL;
    uint32_t                        copy_len, frame_len, cali_data_size;
    uint16_t                       *cali_times = NULL;
    wlan_cali_data_para_stru       *cali_data = NULL;
    OAL_STATIC uint32_t             remain_len = 0;
    wlan_d2h_cali_data_type_enum_uint8 data_type;
    mac_vap_stru *mac_vap = (mac_vap_stru *)mac_res_get_mac_vap(event->st_event_hdr.uc_vap_id);
    if (mac_vap == NULL) {
        oam_error_log0(0, OAM_SF_ANY, "{hmac_save_cali_event_shenkuo::mac_res_get_mac_vap fail}");
        return OAL_ERR_CODE_PTR_NULL;
    }

    cali_data = (wlan_cali_data_para_stru *)get_cali_data_buf_addr();
    cali_save_event  = (hal_cali_hal2hmac_event_stru *)event->auc_event_data;
    payload = (hal_cali_hal2hmac_payload_stru *)oal_netbuf_data(cali_save_event->pst_netbuf);
    data_type = payload->auc_payoald[0];

    if (data_type == WLAN_CALI_SDIO_NULL_EVENT) {
        hmac_send_cali_data_event(mac_vap, cali_times, data_type);
        return OAL_SUCC;
    }
    if (payload->packet_idx == 0 && remain_len != 0) {
        remain_len = 0;
    }

    if (remain_len == 0) {
        cali_data_size = hmac_get_cali_data_size(data_type);
        remain_len = cali_data_size;
        dest_addr = hmac_get_cali_data_save_addr((uint8_t *)cali_data, data_type);
    }

    frame_len = CALI_DATA_NETBUF_SEND_LEN - sizeof(payload->packet_idx) - sizeof(payload->auc_payoald[0]);
    copy_len = oal_min(remain_len, frame_len);
    if (EOK != memcpy_s(dest_addr, remain_len, &payload->auc_payoald[1], copy_len)) {
        oam_error_log0(0, OAM_SF_ANY, "hmac_save_cali_event_shenkuo::memcpy fail!");
        oal_netbuf_free(cali_save_event->pst_netbuf);
        return OAL_FAIL;
    }

    remain_len -= copy_len;
    dest_addr += copy_len;

    if (remain_len == 0) {
        dest_addr = NULL;
        cali_times = &cali_data->common_cali_data.cali_ctl_data.cali_update_info.us_cali_time;
        hmac_send_cali_data_event(mac_vap, cali_times, data_type);
    }
    oal_netbuf_free(cali_save_event->pst_netbuf);
    return OAL_SUCC;
}

void hmac_get_cali_data_for_bt20dbm(void)
{
    hi1103_bt20dbm_txcal_param_stru *puc_bt20dbm_cali_data = NULL;
    uint32_t cali_size_20dbm;
    uint32_t uc_chan_idx;
    uint32_t txdc_index;
    hi1103_cali_param_stru          *pst_cali_data = NULL;
    oam_info_log0(0, OAM_SF_ANY, "[20dbm]start to get 20dbm cali data from wlan");
    pst_cali_data = (hi1103_cali_param_stru *)get_cali_data_buf_addr();
    puc_bt20dbm_cali_data = (hi1103_bt20dbm_txcal_param_stru *)wifi_get_bt_cali_data_buf(&cali_size_20dbm);
    if (puc_bt20dbm_cali_data == NULL) {
        return;
    }
    for (uc_chan_idx = 0; uc_chan_idx < HI1103_2G_CHANNEL_NUM; uc_chan_idx++) {
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:start get the uc_chan_idx:=0x%x cali data", uc_chan_idx);
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].l_txiq_cmp_alpha =
            pst_cali_data->ast_2gcali_param.ast_new_txiq_time_cmp_val[uc_chan_idx].l_txiq_cmp_alpha;
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].l_txiq_cmp_beta  =
            pst_cali_data->ast_2gcali_param.ast_new_txiq_time_cmp_val[uc_chan_idx].l_txiq_cmp_beta;
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.uc_atx_pwr_cmp =
            pst_cali_data->ast_2gcali_param.st_cali_tx_power_cmp_2g[uc_chan_idx].uc_atx_pwr_cmp;
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.s_2g_tx_power_dc =
            pst_cali_data->ast_2gcali_param.st_cali_tx_power_cmp_2g[uc_chan_idx].s_2g_tx_power_dc;
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.uc_dtx_pwr_cmp =
            pst_cali_data->ast_2gcali_param.st_cali_tx_power_cmp_2g[uc_chan_idx].uc_dtx_pwr_cmp;
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:l_txiq_cmp_alpha:=0x%x",
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].l_txiq_cmp_alpha);
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:l_txiq_cmp_beta:=0x%x",
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].l_txiq_cmp_beta);
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:uc_atx_pwr_cmp:=0x%x",
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.uc_atx_pwr_cmp);
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:s_2g_tx_power_dc:=0x%x",
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.s_2g_tx_power_dc);
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:uc_dtx_pwr_cmp:=0x%x",
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.uc_dtx_pwr_cmp);

        for (txdc_index = 0; txdc_index < 8; txdc_index++) { // 8是ast_txdc_cmp_val数组成员最大个数
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].ast_txdc_cmp_val[txdc_index].us_txdc_cmp_i =
                pst_cali_data->ast_2gcali_param.ast_txdc_cmp_val[uc_chan_idx][txdc_index].us_txdc_cmp_i;
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].ast_txdc_cmp_val[txdc_index].us_txdc_cmp_q =
                pst_cali_data->ast_2gcali_param.ast_txdc_cmp_val[uc_chan_idx][txdc_index].us_txdc_cmp_q;
            oam_info_log1(0, OAM_SF_ANY, "[20dbm]:us_txdc_cmp_i:=0x%x",
                pst_cali_data->ast_2gcali_param.ast_txdc_cmp_val[uc_chan_idx][txdc_index].us_txdc_cmp_i);
            oam_info_log1(0, OAM_SF_ANY, "[20dbm]:us_txdc_cmp_q:=0x%x",
                pst_cali_data->ast_2gcali_param.ast_txdc_cmp_val[uc_chan_idx][txdc_index].us_txdc_cmp_q);
        }
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:complete get the uc_chan_idx:=0x%x cali data", uc_chan_idx);
    }
}

OAL_STATIC OAL_INLINE void hmac_1105_bt20dbm_cali_data_dbg_info(
    hi1105_bt20dbm_txcal_param_stru *puc_bt20dbm_cali_data, uint32_t uc_chan_idx)
{
    oam_info_log1(0, OAM_SF_ANY, "[20dbm]:uc_atx_pwr_cmp:=0x%x",
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.us_atx_pwr_cmp);
    oam_info_log1(0, OAM_SF_ANY, "[20dbm]:s_2g_tx_power_dc:=0x%x",
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.s_2g_tx_power_dc);
    oam_info_log1(0, OAM_SF_ANY, "[20dbm]:uc_dtx_pwr_cmp:=0x%x",
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.uc_dtx_pwr_cmp);
}

void hmac_get_1105_cali_data_for_bt20dbm(void)
{
    hi1105_bt20dbm_txcal_param_stru *puc_bt20dbm_cali_data = NULL;
    uint32_t cali_size_20dbm;
    uint32_t uc_chan_idx;
    uint32_t tx_index;
    hi1105_cali_param_stru          *pst_cali_data = NULL;
    hi1105_2gcali_param_stru        *pst_2gcali_param = NULL;

    oam_info_log0(0, OAM_SF_ANY, "[20dbm]start to get 20dbm cali data from wlan");
    pst_cali_data = (hi1105_cali_param_stru *)get_cali_data_buf_addr();
    puc_bt20dbm_cali_data = (hi1105_bt20dbm_txcal_param_stru *)wifi_get_bt_cali_data_buf(&cali_size_20dbm);
    if (puc_bt20dbm_cali_data == NULL) {
        return;
    }
    pst_2gcali_param = &pst_cali_data->st_2gcali_param;
    for (uc_chan_idx = 0; uc_chan_idx < HI1103_2G_CHANNEL_NUM; uc_chan_idx++) {
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:start get the uc_chan_idx:=0x%x cali data", uc_chan_idx);
        // 补充TXIQ补偿值
        for (tx_index = 0; tx_index < HI1105_CALI_TXIQ_GAIN_LVL_NUM; tx_index++) {
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].l_txiq_cmp_alpha[tx_index] =
                pst_2gcali_param->ast_new_txiq_cmp[uc_chan_idx][HI1105_CALI_SISO].l_txiq_cmp_alpha[tx_index];
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].l_txiq_cmp_beta[tx_index] =
                pst_2gcali_param->ast_new_txiq_cmp[uc_chan_idx][HI1105_CALI_SISO].l_txiq_cmp_beta[tx_index];
            oam_info_log1(0, OAM_SF_ANY, "[20dbm]:l_txiq_cmp_alpha:=0x%x",
                pst_2gcali_param->ast_new_txiq_cmp[uc_chan_idx][HI1105_CALI_SISO].l_txiq_cmp_alpha[tx_index]);
            oam_info_log1(0, OAM_SF_ANY, "[20dbm]:l_txiq_cmp_beta:=0x%x",
                pst_2gcali_param->ast_new_txiq_cmp[uc_chan_idx][HI1105_CALI_SISO].l_txiq_cmp_beta[tx_index]);
        }

        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.us_atx_pwr_cmp =
            pst_2gcali_param->ast_cali_tx_power_cmp_2g[uc_chan_idx].us_atx_pwr_cmp;
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.s_2g_tx_power_dc =
            pst_2gcali_param->ast_cali_tx_power_cmp_2g[uc_chan_idx].s_2g_tx_power_dc;
        (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_20dbmtxpwr.uc_dtx_pwr_cmp =
            pst_2gcali_param->ast_cali_tx_power_cmp_2g[uc_chan_idx].uc_dtx_pwr_cmp;
        hmac_1105_bt20dbm_cali_data_dbg_info(puc_bt20dbm_cali_data, uc_chan_idx); // 封装函数降低行数
        // 补充TXDC补偿值
        for (tx_index = 0; tx_index < HI1105_TXDC_LPF_DAC_GAIN_LVL_NUM; tx_index++) {
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_txdc_cmp_val.aus_txdc_cmp_i[tx_index] =
                pst_2gcali_param->ast_txdc_cmp_val[uc_chan_idx].aus_txdc_cmp_i[tx_index];
            (*puc_bt20dbm_cali_data).st_bt20dbm_txcali_param[uc_chan_idx].st_txdc_cmp_val.aus_txdc_cmp_q[tx_index] =
                pst_2gcali_param->ast_txdc_cmp_val[uc_chan_idx].aus_txdc_cmp_q[tx_index];
            oam_info_log1(0, OAM_SF_ANY, "[20dbm]:us_txdc_cmp_i:=0x%x",
                pst_2gcali_param->ast_txdc_cmp_val[uc_chan_idx].aus_txdc_cmp_i[tx_index]);
            oam_info_log1(0, OAM_SF_ANY, "[20dbm]:us_txdc_cmp_q:=0x%x",
                pst_2gcali_param->ast_txdc_cmp_val[uc_chan_idx].aus_txdc_cmp_q[tx_index]);
        }
        oam_info_log1(0, OAM_SF_ANY, "[20dbm]:complete get the uc_chan_idx:=0x%x cali data", uc_chan_idx);
    }
}


void hmac_set_close_fem_cali_status(oal_bool_enum_uint8 en_switch)
{
    g_en_need_close_fem_cali = en_switch;
    oam_warning_log1(0, OAM_SF_ANY, "hmac_set_close_fem_cali_status:en_switch [%d] !", en_switch);
} /*lint +e801*/ /*lint +e571*/ /*lint +e416*/
