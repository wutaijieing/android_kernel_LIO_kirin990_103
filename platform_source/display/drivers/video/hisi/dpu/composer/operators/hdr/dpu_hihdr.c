/** @file
 * Copyright (c) 2020-2020, Hisilicon Tech. Co., Ltd. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 */

#include "dpu_hihdr.h"
#include "dpu_hdr_def.h"
#include "hisi_disp.h"
#include "hisi_fb.h"
#include <securec.h>
#include <linux/moduleparam.h>
#include <linux/uaccess.h>

struct dpu_hdr_info g_hdr_info;

unsigned hisi_hdr_display_effect_test_color = 0x7;

module_param_named(debug_hdr_effect_test_color,
	hisi_hdr_display_effect_test_color, int, 0644);

MODULE_PARM_DESC(debug_hdr_effect_test_color,
	"hisi_hdr_display_effect_test_color");

unsigned hisi_hdr_display_effect_test = 0x1;
module_param_named(debug_hdr_effect_test, hisi_hdr_display_effect_test, int,
	0644);
MODULE_PARM_DESC(debug_hdr_effect_test, "hisi_hdr_display_effect_test");

/***** degamma	********/
unsigned hisi_effect_lut_r = 11;
module_param_named(debug_effect_lut_r, hisi_effect_lut_r, int, 0644);
MODULE_PARM_DESC(debug_effect_lut_r, "hisi_effect_lut_r");

unsigned hisi_effect_lut_g = 11;
module_param_named(debug_effect_lut_g, hisi_effect_lut_g, int, 0644);
MODULE_PARM_DESC(debug_effect_lut_g, "hisi_effect_lut_g");

unsigned hisi_effect_lut_b = 11;
module_param_named(debug_effect_lut_b, hisi_effect_lut_b, int, 0644);
MODULE_PARM_DESC(debug_effect_lut_b, "hisi_effect_lut_b");

/***** gamma	********/
unsigned hisi_gamma_lut_r = 11;
module_param_named(debug_hdr_gamma_lut_r, hisi_gamma_lut_r, int, 0644);
MODULE_PARM_DESC(debug_hdr_gamma_lut_r, "hisi_gamma_lut_r");

unsigned hisi_gamma_lut_g = 11;
module_param_named(debug_hdr_gamma_lut_g, hisi_gamma_lut_g, int, 0644);
MODULE_PARM_DESC(debug_hdr_gamma_lut_g, "hisi_gamma_lut_g");

unsigned hisi_gamma_lut_b = 11;
module_param_named(debug_hdr_gamma_lut_b, hisi_gamma_lut_b, int, 0644);
MODULE_PARM_DESC(debug_hdr_gamma_lut_b, "hisi_gamma_lut_b");

unsigned hisi_gamma_test_mode = 0x2;
module_param_named(debug_test_mode, hisi_gamma_test_mode, int, 0644);
MODULE_PARM_DESC(debug_test_mode, "hisi_gamma_test_mode");

unsigned hisi_hdr_gmp_lut = 0; // 0 means normal 1means no-normal

module_param_named(debug_hdr_gmp_lut, hisi_hdr_gmp_lut, int, 0644);

MODULE_PARM_DESC(debug_hdr_gmp_lut, "hisi_hdr_gmp_lut");
/***** test	********/

#define IGM_LUT_LEN ((uint32_t)257)
#define GAMMA_LUT_LEN ((uint32_t)257)
#define GMP_COFE_CNT 729 // 9*9*9
// GMP:BT2020->P3
static u32 gmp_lut_low[] = {
	0x00000000, 0x00000205, 0x00000409, 0x0000060c, 0x00000810, 0x00000a13,
	0x00000c17, 0x00000e1b, 0x00000fff, 0x00217000, 0x002141ff, 0x0020c406,
	0x001fd60b, 0x001e680f, 0x001c6a13, 0x00198c16, 0x00157e1a, 0x000f8fff,
	0x00427000, 0x004251ef, 0x004213ff, 0x0041b606, 0x0041080b, 0x00402a10,
	0x003efc14, 0x003d7e19, 0x003b9fff, 0x00636000, 0x006361d2, 0x006333f1,
	0x0062f5fe, 0x00629806, 0x00620a0c, 0x00615c11, 0x00607e16, 0x005f5fff,
	0x00846000, 0x008461a3, 0x008443dd, 0x008415f2, 0x0083d7fd, 0x00837a06,
	0x0082fc0c, 0x00825e12, 0x00819fff, 0x00a56000, 0x00a56159, 0x00a553c1,
	0x00a525e1, 0x00a4f7f2, 0x00a4a9fd, 0x00a45c05, 0x00a3de0c, 0x00a34fff,
	0x00c66000, 0x00c660df, 0x00c6439a, 0x00c635ca, 0x00c607e2, 0x00c5d9f1,
	0x00c58bfc, 0x00c52e04, 0x00c4bfff, 0x00e76000, 0x00e75006, 0x00e75368,
	0x00e735ae, 0x00e717cf, 0x00e6e9e3, 0x00e6abf1, 0x00e66dfb, 0x00e60fff,
	0x00fff000, 0x00fff000, 0x00fff326, 0x00fff58b, 0x00fff7b7, 0x00fff9d2,
	0x00fffbe3, 0x00fffdf0, 0x00fffffa,

	0x61000002, 0x51000206, 0x25000409, 0xcf00060c, 0x24000810, 0x00000a13,
	0x00000c17, 0x00000e1b, 0x00000fff, 0x13203000, 0x00200200, 0xce1f8406,
	0x641e960b, 0x6f1d180f, 0x001afa13, 0x0017ec16, 0x00139e1a, 0x000d0fff,
	0xf741d000, 0xd241c1f0, 0x5f4183ff, 0x00411606, 0x0040780c, 0x003f8a10,
	0x003e6c15, 0x003cde19, 0x003affff, 0x00631000, 0x006301d4, 0x0062d3f2,
	0x006295fe, 0x00623806, 0x0061aa0c, 0x0060fc11, 0x00601e16, 0x005effff,
	0x00842000, 0x008421a5, 0x008403de, 0x0083d5f2, 0x008397fd, 0x00833a06,
	0x0082bc0c, 0x00821e12, 0x00815fff, 0x00a53000, 0x00a5315a, 0x00a513c1,
	0x00a4f5e1, 0x00a4c7f2, 0x00a479fd, 0x00a41c05, 0x00a3ae0c, 0x00a31fff,
	0x00c64000, 0x00c630e1, 0x00c6239b, 0x00c605cb, 0x00c5e7e2, 0x00c5a9f1,
	0x00c56bfc, 0x00c50e05, 0x00c49fff, 0x00e74000, 0x00e73008, 0x00e73368,
	0x00e715ae, 0x00e6f7cf, 0x00e6c9e3, 0x00e68bf1, 0x00e64dfb, 0x00e5efff,
	0x00fff000, 0x00fff000, 0x00fff327, 0x00fff58b, 0x00fff7b8, 0x00fff9d2,
	0x00fffbe3, 0x00fffdf1, 0x00fffffa,

	0xa4000008, 0x9c000208, 0x8800040a, 0x6400060d, 0x2b000810, 0xd7000a14,
	0x5c000c17, 0xa0000e1b, 0x41000fff, 0x801ce000, 0x781ca202, 0x641c1407,
	0x3e1b060c, 0x0319580f, 0xab16ea13, 0x28135c17, 0x5a0e0e1a, 0x9c056fff,
	0x1f405000, 0x174041f3, 0x00400400, 0xd63f9607, 0x933ee80c, 0x2c3dfa11,
	0x8e3ccc15, 0x733b3e19, 0x00394fff, 0x53622000, 0x486211d6, 0x2b61f3f3,
	0xf461b5ff, 0x97614806, 0xfd60ca0c, 0xba600c11, 0x005f1e16, 0x005e0fff,
	0x5f838000, 0x448381a7, 0xf38363df, 0x2c8335f3, 0x0082f7fe, 0x00828a06,
	0x00821c0c, 0x00816e12, 0x0080bfff, 0x00a4c000, 0x00a4b15e, 0x00a4a3c2,
	0x00a475e2, 0x00a447f2, 0x00a409fd, 0x00a3ac05, 0x00a33e0c, 0x00a2afff,
	0x00c5d000, 0x00c5d0e5, 0x00c5c39c, 0x00c5b5cb, 0x00c587e3, 0x00c549f2,
	0x00c50bfc, 0x00c4ae05, 0x00c43fff, 0x00e6f000, 0x00e6f00e, 0x00e6e369,
	0x00e6c5af, 0x00e6a7d0, 0x00e679e4, 0x00e63bf1, 0x00e5fdfc, 0x00e59fff,
	0x00fff000, 0x00fff000, 0x00fff328, 0x00fff58c, 0x00fff7b8, 0x00fff9d2,
	0x00fffbe4, 0x00fffdf1, 0x00fffffa,

	0xe7000011, 0xe200020c, 0xd600040c, 0xc000060e, 0x9f000811, 0x70000a14,
	0x30000c18, 0xdd000e1b, 0x70000fff, 0xd115c002, 0xcc158206, 0xc014c409,
	0xaa13660d, 0x88112810, 0x580d9a13, 0x1707ec17, 0xc2006e1b, 0x52000fff,
	0x983d9000, 0x933d81f7, 0x863d4402, 0x6f3cc608, 0x4c3c180d, 0x1a3b1a11,
	0xd639cc15, 0x7b382e19, 0x05361fff, 0x2c608000, 0x276071da, 0x196043f5,
	0x00600600, 0xd95f9807, 0xa25f0a0d, 0x575e5c12, 0xf25d6e16, 0x695c4fff,
	0x77826000, 0x708251ac, 0x608243e1, 0x438215f4, 0x1581c7ff, 0xd4816a07,
	0x7880ec0d, 0xf8804e12, 0x417f8fff, 0x42a3e000, 0x39a3d163, 0x23a3c3c4,
	0xfba3a5e3, 0xbba377f3, 0x5aa329fe, 0xc7a2cc06, 0xcfa25e0d, 0x00a1cfff,
	0x6dc53000, 0x53c520ed, 0x06c5239e, 0x45c505cc, 0x00c4d7e4, 0x00c499f2,
	0x00c45bfd, 0x00c3fe05, 0x00c38fff, 0x00e66000, 0x00e66017, 0x00e6536c,
	0x00e635b0, 0x00e617d0, 0x00e5f9e4, 0x00e5bbf2, 0x00e56dfc, 0x00e50fff,
	0x00fff000, 0x00fff000, 0x00fff32b, 0x00fff58d, 0x00fff7b9, 0x00fff9d3,
	0x00fffbe4, 0x00fffdf1, 0x00fffffa,

	0x2a000020, 0x26000212, 0x1e00040f, 0x0f000610, 0xf8000812, 0xd8000a15,
	0xae000c19, 0x78000e1c, 0x35000fff, 0x1a04d011, 0x1704520c, 0x0f03140c,
	0xff00d60e, 0xe9000811, 0xc8000a14, 0x9e000c18, 0x68000e1b, 0x24000fff,
	0xf4392000, 0xf03901fd, 0xe738b405, 0xd838360a, 0xc037780e, 0x9f366a12,
	0x7434fc16, 0x3c332e1a, 0xf630dfff, 0xab5df000, 0xa85de1e0, 0x9f5db3f8,
	0x8f5d7602, 0x765d0809, 0x545c7a0e, 0x265bbc12, 0xec5abe17, 0xa2599fff,
	0x3980a000, 0x368091b2, 0x2c8083e3, 0x1b8045f5, 0x00800800, 0xdb7faa08,
	0xaa7f2c0e, 0x6a7e7e13, 0x1b7dbfff, 0x8ea29000, 0x8aa2816c, 0x7fa273c7,
	0x6ca255e5, 0x4fa227f4, 0x25a1d9ff, 0xeea17c07, 0xa5a0fe0d, 0x49a06fff,
	0x90c42000, 0x8bc420f8, 0x7fc413a1, 0x67c3f5ce, 0x44c3d7e5, 0x11c399f3,
	0xccc34bfe, 0x72c2ee06, 0xfac27fff, 0xfce59000, 0xf5e58026, 0xe3e5836f,
	0xc2e565b2, 0x8fe547d2, 0x43e519e5, 0xd8e4dbf3, 0x3be49dfd, 0x44e43fff,
	0x0ffff000, 0xedfff000, 0x81fff32e, 0x00fff58f, 0x00fff7ba, 0x00fff9d4,
	0x00fffbe5, 0x00fffdf2, 0x00fffffb,

	0x6d000034, 0x6a00021a, 0x64000413, 0x59000612, 0x47000814, 0x30000a17,
	0x11000c19, 0xea000e1d, 0xba000fff, 0x61000025, 0x5f000214, 0x59000410,
	0x4d000611, 0x3c000813, 0x24000a15, 0x05000c19, 0xde000e1c, 0xad000fff,
	0x44324000, 0x42322205, 0x3b31d408, 0x3031460c, 0x1e306810, 0x062f1a13,
	0xe72d6c17, 0xbf2b4e1b, 0x8d287fff, 0x0f5a4000, 0x0c5a31e9, 0x065a13fc,
	0xfa59c604, 0xe859580a, 0xcf58ba0f, 0xaf57ec14, 0x8656ee18, 0x5455bfff,
	0xbd7e3000, 0xba7e21bc, 0xb37e03e8, 0xa77de5f8, 0x947d9802, 0x7b7d2a09,
	0x597cac0e, 0x2e7c0e14, 0xf97b3fff, 0x46a0c000, 0x43a0c176, 0x3ca0a3cb,
	0x2fa085e7, 0x1ba057f6, 0x00a00a00, 0xdc9fac08, 0xaf9f2e0e, 0x769e9fff,
	0xa2c2c000, 0x9ec2b107, 0x97c2b3a6, 0x89c295d1, 0x73c267e7, 0x55c229f5,
	0x2ec1ebff, 0xfcc18e07, 0xbec11fff, 0xbfe46000, 0xbbe4603a, 0xb2e46374,
	0xa2e445b5, 0x8ae427d4, 0x68e3f9e6, 0x3be3bbf3, 0x02e36dfd, 0xb9e30fff,
	0x80fff000, 0x7cfff000, 0x71fff333, 0x5dfff592, 0x3ffff7bc, 0x16fff9d5,
	0xdefffbe6, 0x94fffdf2, 0x37fffffc,

	0xb000004e, 0xae000224, 0xa9000418, 0xa0000615, 0x93000816, 0x80000a18,
	0x68000c1b, 0x49000e1e, 0x24000fff, 0xa700003f, 0xa500021e, 0xa0000415,
	0x97000614, 0x8a000815, 0x77000a17, 0x5f000c1a, 0x40000e1d, 0x1b000fff,
	0x90278019, 0x8e27520f, 0x8926f40e, 0x8026360f, 0x72250812, 0x5f235a15,
	0x47210c18, 0x281dfe1b, 0x0219cfff, 0x66554000, 0x645531f4, 0x5f550401,
	0x5654b607, 0x4854480c, 0x35539a11, 0x1c52cc15, 0xfd51ae19, 0xd7505fff,
	0x267af000, 0x247ae1c8, 0x1f7ac3ed, 0x167a95fb, 0x087a4804, 0xf479ea0a,
	0xdb795c10, 0xba78ae15, 0x9377dfff, 0xcc9e6000, 0xca9e6184, 0xc59e43d1,
	0xbb9e25ea, 0xac9df7f8, 0x989daa02, 0x7e9d4c09, 0x5c9cce0f, 0x349c2fff,
	0x53c0e000, 0x51c0e119, 0x4bc0d3ab, 0x41c0b5d4, 0x31c097e9, 0x1cc059f6,
	0x00c00c00, 0xddbfae08, 0xb2bf3fff, 0xb3e2f000, 0xb0e2e054, 0xaae2d37a,
	0x9fe2c5b8, 0x8fe2a7d6, 0x78e279e8, 0x5ae23bf5, 0x34e1edff, 0x05e19fff,
	0xe1fff000, 0xdffff000, 0xd8fff33a, 0xccfff595, 0xbafff7be, 0xa0fff9d7,
	0x7ffffbe7, 0x55fffdf4, 0x21fffffd,

	0xf300006f, 0xf1000230, 0xed00041e, 0xe6000619, 0xdb000819, 0xcc000a1a,
	0xb8000c1c, 0xa0000e1f, 0x82000fff, 0xeb00005f, 0xea00022a, 0xe600041b,
	0xdf000617, 0xd4000818, 0xc4000a19, 0xb1000c1c, 0x98000e1e, 0x7a000fff,
	0xd913003a, 0xd712b21c, 0xd311e414, 0xcc104613, 0xc10da814, 0xb2095a17,
	0x9e035c1a, 0x85000e1d, 0x67000fff, 0xb74e8000, 0xb54e7201, 0xb14e3407,
	0xaa4de60b, 0x9f4d680f, 0x8f4caa13, 0x7b4bbc17, 0x624a8e1a, 0x44490fff,
	0x8476c000, 0x8276b1d7, 0x7e7693f3, 0x767665ff, 0x6b761806, 0x5b75aa0c,
	0x47751c11, 0x2d745e16, 0x0e738fff, 0x3c9b6000, 0x3a9b5195, 0x369b43d7,
	0x2e9b25ee, 0x229ae7fb, 0x129a9a03, 0xfd9a3c0b, 0xe399be10, 0xc3991fff,
	0xdcbe9000, 0xdabe912f, 0xd5be83b2, 0xcebe65d8, 0xc1be37ec, 0xb1bdf9f8,
	0x9bbdac02, 0x80bd5e09, 0x5fbcdfff, 0x60e11000, 0x5ee10074, 0x59e10381,
	0x51e0e5bc, 0x44e0c7d9, 0x33e099ea, 0x1ce05bf6, 0x00e00e00, 0xdedfafff,
	0xc3fff000, 0xc1fff000, 0xbcfff342, 0xb3fff599, 0xa6fff7c1, 0x93fff9d9,
	0x7bfffbe9, 0x5dfffdf5, 0x39fffffe,

	0xff000095, 0xff00023e, 0xff000425, 0xff00061e, 0xff00081c, 0xff000a1c,
	0xff000c1e, 0xff000e20, 0xff000fff, 0xff000086, 0xff000238, 0xff000422,
	0xff00061c, 0xff00081b, 0xff000a1c, 0xff000c1e, 0xff000e20, 0xff000fff,
	0xff000061, 0xff00022a, 0xff00041b, 0xff000618, 0xff000818, 0xff000a1a,
	0xff000c1c, 0xff000e1e, 0xff000fff, 0xff45501d, 0xff453211, 0xff45040e,
	0xff449610, 0xff440812, 0xff432a15, 0xff420c18, 0xff409e1c, 0xff3edfff,
	0xff716000, 0xff7161e7, 0xff7143fb, 0xff710604, 0xff70b80a, 0xff704a0f,
	0xff6fac13, 0xff6eee18, 0xff6dffff, 0xff97a000, 0xff9791a8, 0xff9783df,
	0xff9765f3, 0xff9727fe, 0xff96da06, 0xff967c0c, 0xff95ee12, 0xff954fff,
	0xffbbc000, 0xffbbb147, 0xffbba3ba, 0xffbb85dd, 0xffbb67ef, 0xffbb19fb,
	0xffbadc03, 0xffba6e0b, 0xffb9ffff, 0xffdec000, 0xffdec09b, 0xffdeb38a,
	0xffde95c1, 0xffde77dc, 0xffde49ed, 0xffde0bf8, 0xffddbe02, 0xffdd5fff,
	0xfffff000, 0xfffff000, 0xfffff34b, 0xfffff59f, 0xfffff7c5, 0xfffff9db,
	0xfffffbeb, 0xfffffdf7, 0xffffffff};

static u32 gmp_lut_high[] = {
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

	0x2, 0x2, 0x2, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x2, 0x2, 0x1, 0x1, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

	0x4, 0x4, 0x4, 0x4, 0x4, 0x3, 0x3, 0x2, 0x1, 0x4, 0x4, 0x4, 0x4, 0x4,
	0x3, 0x3, 0x2, 0x0, 0x4, 0x4, 0x4, 0x3, 0x3, 0x3, 0x2, 0x1, 0x0, 0x3,
	0x3, 0x3, 0x2, 0x2, 0x1, 0x0, 0x0, 0x0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

	0x6, 0x6, 0x6, 0x6, 0x6, 0x6, 0x6, 0x5, 0x5, 0x6, 0x6, 0x6, 0x6, 0x6,
	0x6, 0x6, 0x5, 0x5, 0x6, 0x6, 0x6, 0x6, 0x6, 0x6, 0x5, 0x5, 0x5, 0x6,
	0x6, 0x6, 0x6, 0x5, 0x5, 0x5, 0x4, 0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x4,
	0x4, 0x3, 0x3, 0x4, 0x4, 0x4, 0x3, 0x3, 0x3, 0x2, 0x1, 0x0, 0x1, 0x1,
	0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
	0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

	0x9, 0x9, 0x9, 0x9, 0x8, 0x8, 0x8, 0x8, 0x8, 0x9, 0x9, 0x9, 0x8, 0x8,
	0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x7, 0x8,
	0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x7, 0x7, 0x8, 0x8, 0x8, 0x8, 0x8, 0x7,
	0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x6, 0x6, 0x6, 0x6, 0x6,
	0x6, 0x6, 0x6, 0x6, 0x5, 0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x3,
	0x3, 0x2, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

	0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xa, 0xa, 0xb, 0xb, 0xb, 0xb, 0xb,
	0xb, 0xb, 0xa, 0xa, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xa, 0xa, 0xa, 0xb,
	0xb, 0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa,
	0xa, 0xa, 0x9, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0x9, 0x9, 0x9, 0x9, 0x9,
	0x9, 0x9, 0x9, 0x9, 0x9, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8,
	0x8, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x6, 0x6, 0x6,

	0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd,
	0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd,
	0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xc, 0xc, 0xd, 0xd, 0xd, 0xd, 0xd, 0xc,
	0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc, 0xc,
	0xc, 0xc, 0xc, 0xc, 0xc, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb,
	0xb, 0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa,

	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xe, 0xe, 0xe, 0xe, 0xe,
	0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe, 0xe,
	0xe, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd, 0xd,

	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf,
	0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf, 0xf};

static u32 gama_lut_table_linear[] = {
	0x0000, 0x0010, 0x0020, 0x0030, 0x0040, 0x0050, 0x0060, 0x0070, 0x0080,
	0x0090, 0x00a0, 0x00b0, 0x00c0, 0x00d0, 0x00e0, 0x00f0, 0x0100, 0x0110,
	0x0120, 0x0130, 0x0140, 0x0150, 0x0160, 0x0170, 0x0180, 0x0190, 0x01a0,
	0x01b0, 0x01c0, 0x01d0, 0x01e0, 0x01f0, 0x0200, 0x0210, 0x0220, 0x0230,
	0x0240, 0x0250, 0x0260, 0x0270, 0x0280, 0x0290, 0x02a0, 0x02b0, 0x02c0,
	0x02d0, 0x02e0, 0x02f0, 0x0300, 0x0310, 0x0320, 0x0330, 0x0340, 0x0350,
	0x0360, 0x0370, 0x0380, 0x0390, 0x03a0, 0x03b0, 0x03c0, 0x03d0, 0x03e0,
	0x03f0, 0x0400, 0x0410, 0x0420, 0x0430, 0x0440, 0x0450, 0x0460, 0x0470,
	0x0480, 0x0490, 0x04a0, 0x04b0, 0x04c0, 0x04d0, 0x04e0, 0x04f0, 0x0500,
	0x0510, 0x0520, 0x0530, 0x0540, 0x0550, 0x0560, 0x0570, 0x0580, 0x0590,
	0x05a0, 0x05b0, 0x05c0, 0x05d0, 0x05e0, 0x05f0, 0x0600, 0x0610, 0x0620,
	0x0630, 0x0640, 0x0650, 0x0660, 0x0670, 0x0680, 0x0690, 0x06a0, 0x06b0,
	0x06c0, 0x06d0, 0x06e0, 0x06f0, 0x0700, 0x0710, 0x0720, 0x0730, 0x0740,
	0x0750, 0x0760, 0x0770, 0x0780, 0x0790, 0x07a0, 0x07b0, 0x07c0, 0x07d0,
	0x07e0, 0x07f0, 0x0800, 0x0810, 0x0820, 0x0830, 0x0840, 0x0850, 0x0860,
	0x0870, 0x0880, 0x0890, 0x08a0, 0x08b0, 0x08c0, 0x08d0, 0x08e0, 0x08f0,
	0x0900, 0x0910, 0x0920, 0x0930, 0x0940, 0x0950, 0x0960, 0x0970, 0x0980,
	0x0990, 0x09a0, 0x09b0, 0x09c0, 0x09d0, 0x09e0, 0x09f0, 0x0a00, 0x0a10,
	0x0a20, 0x0a30, 0x0a40, 0x0a50, 0x0a60, 0x0a70, 0x0a80, 0x0a90, 0x0aa0,
	0x0ab0, 0x0ac0, 0x0ad0, 0x0ae0, 0x0af0, 0x0b00, 0x0b10, 0x0b20, 0x0b30,
	0x0b40, 0x0b50, 0x0b60, 0x0b70, 0x0b80, 0x0b90, 0x0ba0, 0x0bb0, 0x0bc0,
	0x0bd0, 0x0be0, 0x0bf0, 0x0c00, 0x0c10, 0x0c20, 0x0c30, 0x0c40, 0x0c50,
	0x0c60, 0x0c70, 0x0c80, 0x0c90, 0x0ca0, 0x0cb0, 0x0cc0, 0x0cd0, 0x0ce0,
	0x0cf0, 0x0d00, 0x0d10, 0x0d20, 0x0d30, 0x0d40, 0x0d50, 0x0d60, 0x0d70,
	0x0d80, 0x0d90, 0x0da0, 0x0db0, 0x0dc0, 0x0dd0, 0x0de0, 0x0df0, 0x0e00,
	0x0e10, 0x0e20, 0x0e30, 0x0e40, 0x0e50, 0x0e60, 0x0e70, 0x0e80, 0x0e90,
	0x0ea0, 0x0eb0, 0x0ec0, 0x0ed0, 0x0ee0, 0x0ef0, 0x0f00, 0x0f10, 0x0f20,
	0x0f30, 0x0f40, 0x0f50, 0x0f60, 0x0f70, 0x0f80, 0x0f90, 0x0fa0, 0x0fb0,
	0x0fc0, 0x0fd0, 0x0fe0, 0x0ff0, 0xfff,
};

static u32 gama_lut_table_nolinear[] = {
	0x0000, 0x00cb, 0x015b, 0x01c4, 0x021a, 0x0264, 0x02a6, 0x02e2, 0x0319,
	0x034c, 0x037c, 0x03a9, 0x03d4, 0x03fd, 0x0424, 0x044a, 0x046e, 0x0490,
	0x04b2, 0x04d2, 0x04f2, 0x0511, 0x052e, 0x054b, 0x0568, 0x0583, 0x059e,
	0x05b8, 0x05d2, 0x05eb, 0x0604, 0x061d, 0x0634, 0x064c, 0x0663, 0x0679,
	0x0690, 0x06a5, 0x06bb, 0x06d0, 0x06e5, 0x06fa, 0x070e, 0x0722, 0x0736,
	0x0749, 0x075c, 0x076f, 0x0782, 0x0794, 0x07a7, 0x07b9, 0x07cb, 0x07dc,
	0x07ee, 0x07ff, 0x0810, 0x0821, 0x0832, 0x0843, 0x0853, 0x0863, 0x0874,
	0x0883, 0x0893, 0x08a3, 0x08b3, 0x08c2, 0x08d1, 0x08e0, 0x08ef, 0x08fe,
	0x090d, 0x091c, 0x092a, 0x0939, 0x0947, 0x0955, 0x0963, 0x0971, 0x097f,
	0x098d, 0x099b, 0x09a8, 0x09b6, 0x09c3, 0x09d0, 0x09de, 0x09eb, 0x09f8,
	0x0a05, 0x0a12, 0x0a1e, 0x0a2b, 0x0a38, 0x0a44, 0x0a51, 0x0a5d, 0x0a69,
	0x0a76, 0x0a82, 0x0a8e, 0x0a9a, 0x0aa6, 0x0ab2, 0x0abe, 0x0ac9, 0x0ad5,
	0x0ae1, 0x0aec, 0x0af8, 0x0b03, 0x0b0f, 0x0b1a, 0x0b25, 0x0b31, 0x0b3c,
	0x0b47, 0x0b52, 0x0b5d, 0x0b68, 0x0b73, 0x0b7e, 0x0b88, 0x0b93, 0x0b9e,
	0x0ba8, 0x0bb3, 0x0bbe, 0x0bc8, 0x0bd2, 0x0bdd, 0x0be7, 0x0bf2, 0x0bfc,
	0x0c06, 0x0c10, 0x0c1a, 0x0c24, 0x0c2e, 0x0c38, 0x0c42, 0x0c4c, 0x0c56,
	0x0c60, 0x0c6a, 0x0c74, 0x0c7d, 0x0c87, 0x0c91, 0x0c9a, 0x0ca4, 0x0cad,
	0x0cb7, 0x0cc0, 0x0cca, 0x0cd3, 0x0cdc, 0x0ce6, 0x0cef, 0x0cf8, 0x0d01,
	0x0d0b, 0x0d14, 0x0d1d, 0x0d26, 0x0d2f, 0x0d38, 0x0d41, 0x0d4a, 0x0d53,
	0x0d5c, 0x0d65, 0x0d6e, 0x0d76, 0x0d7f, 0x0d88, 0x0d91, 0x0d99, 0x0da2,
	0x0dab, 0x0db3, 0x0dbc, 0x0dc4, 0x0dcd, 0x0dd5, 0x0dde, 0x0de6, 0x0def,
	0x0df7, 0x0dff, 0x0e08, 0x0e10, 0x0e18, 0x0e21, 0x0e29, 0x0e31, 0x0e39,
	0x0e41, 0x0e49, 0x0e52, 0x0e5a, 0x0e62, 0x0e6a, 0x0e72, 0x0e7a, 0x0e82,
	0x0e8a, 0x0e92, 0x0e9a, 0x0ea1, 0x0ea9, 0x0eb1, 0x0eb9, 0x0ec1, 0x0ec9,
	0x0ed0, 0x0ed8, 0x0ee0, 0x0ee8, 0x0eef, 0x0ef7, 0x0efe, 0x0f06, 0x0f0e,
	0x0f15, 0x0f1d, 0x0f24, 0x0f2c, 0x0f33, 0x0f3b, 0x0f42, 0x0f4a, 0x0f51,
	0x0f59, 0x0f60, 0x0f67, 0x0f6f, 0x0f76, 0x0f7d, 0x0f85, 0x0f8c, 0x0f93,
	0x0f9a, 0x0fa2, 0x0fa9, 0x0fb0, 0x0fb7, 0x0fbe, 0x0fc6, 0x0fcd, 0x0fd4,
	0x0fdb, 0x0fe2, 0x0fe9, 0x0ff0, 0xfff,
};

static u32 degama_lut_table_nolinear[] = {
	0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019,
	0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019, 0x0019,
	0x0018, 0x0018, 0x0018, 0x0018, 0x0018, 0x0018, 0x0018, 0x0018, 0x0017,
	0x0017, 0x0017, 0x0017, 0x0016, 0x0016, 0x0016, 0x0015, 0x0015, 0x0014,
	0x0014, 0x0013, 0x0012, 0x0011, 0x0010, 0x000f, 0x000d, 0x000b, 0x0009,
	0x0002, 0x0036, 0x004c, 0x005d, 0x006d, 0x007a, 0x0087, 0x0094, 0x00a0,
	0x00ac, 0x00b8, 0x00c3, 0x00cf, 0x00db, 0x00e6, 0x00f2, 0x00fe, 0x010a,
	0x0116, 0x0122, 0x012e, 0x013a, 0x0147, 0x0154, 0x0161, 0x016e, 0x017b,
	0x0189, 0x0197, 0x01a5, 0x01b3, 0x01c2, 0x01d0, 0x01df, 0x01ef, 0x01fe,
	0x020e, 0x021e, 0x022e, 0x023f, 0x0250, 0x0261, 0x0273, 0x0284, 0x0297,
	0x02a9, 0x02bc, 0x02cf, 0x02e2, 0x02f6, 0x030a, 0x031e, 0x0333, 0x0348,
	0x035d, 0x0373, 0x0389, 0x03a0, 0x03b7, 0x03ce, 0x03e5, 0x03fd, 0x0416,
	0x042e, 0x0447, 0x0461, 0x047b, 0x0495, 0x04b0, 0x04cb, 0x04e6, 0x0502,
	0x051f, 0x053b, 0x0559, 0x0576, 0x0594, 0x05b3, 0x05d2, 0x05f1, 0x0611,
	0x0631, 0x0652, 0x0673, 0x0695, 0x06b7, 0x06da, 0x06fd, 0x0721, 0x0745,
	0x076a, 0x078f, 0x07b5, 0x07db, 0x0802, 0x0829, 0x0851, 0x087a, 0x08a3,
	0x08cc, 0x08f6, 0x0921, 0x094c, 0x0978, 0x09a4, 0x09d1, 0x09ff, 0x0a2d,
	0x0a5c, 0x0a8b, 0x0abb, 0x0aec, 0x0b1d, 0x0b4f, 0x0b82, 0x0bb6, 0x0bea,
	0x0c1e, 0x0c54, 0x0c8a, 0x0cc1, 0x0cf8, 0x0d31, 0x0d6a, 0x0da4, 0x0dde,
	0x0e1a, 0x0e56, 0x0e93, 0x0ed1, 0x0f10, 0x0f4f, 0x0f90, 0x0fd1, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
	0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
};

static void dpu_hdr_top_init(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base) {
	disp_pr_debug(" ++++ , hdr_baset %p", hdr_base);

	hisi_module_set_reg(module_desc, DPU_HDR_RD_SHADOW_ADDR(hdr_base), 0x0);

	hisi_module_set_reg(module_desc, DPU_HDR_REG_DEFAULT_ADDR(hdr_base), 0x0);

	hisi_module_set_reg(module_desc, DPU_HDR_TOP_CLK_SEL_ADDR(hdr_base),
			0xFFFFFFFF);

	hisi_module_set_reg(module_desc, DPU_HDR_TOP_CLK_EN_ADDR(hdr_base),
			0xFFFFFFFF);
	disp_pr_debug(" ----");
}

static void dpu_hdr_mem_ctrl(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base) {
	hisi_module_set_reg(module_desc, DPU_HDR_MEM_CTRL_ADDR(hdr_base), 0x8);

	hisi_module_set_reg(module_desc, DPU_HDR_DEGAMMA_MEM_CTRL_ADDR(hdr_base),
		0x8);
	hisi_module_set_reg(module_desc, DPU_HDR_GMP_MEM_CTRL_ADDR(hdr_base), 0x8);
	hisi_module_set_reg(module_desc, DPU_HDR_GAMMA_MEM_CTRL_ADDR(hdr_base), 0x8);
}

void dpu_hdr_reg_init(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base) {
	dpu_hdr_top_init(module_desc, hdr_base);

	dpu_hdr_mem_ctrl(module_desc, hdr_base);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_CTRL_ADDR(hdr_base), 0x0);
}

static void hihdr_gtm_slf_lcproc_set_reg(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base,
	hihdr_gtm_info_t *gtm_info) {
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_LCPROC_MIN_E_ADDR(hdr_base),
			gtm_info->output_min_e << 16 | gtm_info->input_min_e);

	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_LCPROC_CLIP_ADDR(hdr_base),
		gtm_info->ratiolutoutclip << 16 |
		gtm_info->ratiolutinclip);

	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_LCPROC_SCALE_ADDR(hdr_base),
		(gtm_info->lumaoutbit1 << 20) |
		(gtm_info->lumaoutbit0 << 16) |
		(gtm_info->chromaratiolutstep1 << 12) |
		(gtm_info->chromaratiolutstep0 << 8) |
		(gtm_info->lumaratiolutstep1 << 4) |
		(gtm_info->lumaratiolutstep0 << 0));

	hisi_module_set_reg(module_desc,
		DPU_HDR_GTM_SLF_LCPROC_THRESHOLD_ADDR(hdr_base),
		gtm_info->chromalutthres << 16 | gtm_info->lumalutthres);

	hisi_module_set_reg(
		module_desc, DPU_HDR_GTM_SLF_LCPROC_Y_TRANSFM0_ADDR(hdr_base),
		gtm_info->y_transform[1] << 16 | gtm_info->y_transform[0]);

	hisi_module_set_reg(module_desc,
		DPU_HDR_GTM_SLF_LCPROC_Y_TRANSFM1_ADDR(hdr_base),
		gtm_info->y_transform[2]);

	hisi_module_set_reg(module_desc,
		DPU_HDR_GTM_SLF_LCPROC_OUT_BIT_ADDR(hdr_base),
		gtm_info->chromaoutbit2 << 8 | gtm_info->chromaoutbit1);

	hisi_module_set_reg(module_desc,
		DPU_HDR_GTM_SLF_LCPROC_CRATIOCLIP_ADDR(hdr_base),
		gtm_info->chromaratioclip);
}

static void hihdr_gtm_slf_pq2slf_set_reg(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base,
	hihdr_gtm_info_t *gtm_info) {
	hisi_module_set_reg(
		module_desc, DPU_HDR_GTM_SLF_PQ2SLF_STEP1_ADDR(hdr_base),
		(gtm_info->pq2slf_step[3] << 24) | (gtm_info->pq2slf_step[2] << 16) |
		(gtm_info->pq2slf_step[1] << 8) | (gtm_info->pq2slf_step[0]));
	hisi_module_set_reg(
		module_desc, DPU_HDR_GTM_SLF_PQ2SLF_STEP2_ADDR(hdr_base),
		(gtm_info->pq2slf_step[7] << 24) | (gtm_info->pq2slf_step[6] << 16) |
		(gtm_info->pq2slf_step[5] << 8) | (gtm_info->pq2slf_step[4]));

	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS1_ADDR(hdr_base),
		gtm_info->pq2slf_pos[0]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS2_ADDR(hdr_base),
		gtm_info->pq2slf_pos[1]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS3_ADDR(hdr_base),
		gtm_info->pq2slf_pos[2]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS4_ADDR(hdr_base),
		gtm_info->pq2slf_pos[3]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS5_ADDR(hdr_base),
		gtm_info->pq2slf_pos[4]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS6_ADDR(hdr_base),
		gtm_info->pq2slf_pos[5]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS7_ADDR(hdr_base),
		gtm_info->pq2slf_pos[6]);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_SLF_PQ2SLF_POS8_ADDR(hdr_base),
		gtm_info->pq2slf_pos[7]);

	hisi_module_set_reg(
		module_desc, DPU_HDR_GTM_SLF_PQ2SLF_NUM1_ADDR(hdr_base),
		(gtm_info->pq2slf_num[3] << 24) | (gtm_info->pq2slf_num[2] << 16) |
		(gtm_info->pq2slf_num[1] << 8) | (gtm_info->pq2slf_num[0]));
	hisi_module_set_reg(
		module_desc, DPU_HDR_GTM_SLF_PQ2SLF_NUM2_ADDR(hdr_base),
		(gtm_info->pq2slf_num[7] << 24) | (gtm_info->pq2slf_num[6] << 16) |
		(gtm_info->pq2slf_num[5] << 8) | (gtm_info->pq2slf_num[4]));
}

static void hihdr_gtm_lut_set_reg(struct dpu_module_desc *module_desc,
	char __iomem *gtm_lut_base, uint32_t lut_size,
	uint32_t *gtm_lut) {
	uint32_t i = 0;
	uint32_t lut_value = 0;

	for (i = 0; i < lut_size; i++) {
		lut_value = gtm_lut[i * 2 + 1] << 16 | gtm_lut[i * 2];
		hisi_module_set_reg(module_desc, gtm_lut_base + (i * 4), lut_value);
	}
}

static void hihdr_gtm_lut_all_set_reg(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info) {
	disp_pr_debug(
		"CHECK	pq2slf = 0x%x, lumalut0 = 0x%x, chromalut0 = 0x%x, "
		"lut_luma = 0x%x, lut_chroma "
		"= 0x%x, lut_chroma0 = 0x%x, lut_chroma1 = 0x%x, lut_chroma2 = 0x%x \n",
		hdr_info->gtm_info.lut_pq2slf[0], hdr_info->gtm_info.lut_lumalut0[0],
		hdr_info->gtm_info.lut_chromalut0[0], hdr_info->gtm_info.lut_luma[0],
		hdr_info->gtm_info.lut_chroma[0], hdr_info->gtm_info.lut_chroma0[0],
		hdr_info->gtm_info.lut_chroma1[0], hdr_info->gtm_info.lut_chroma2[0]);
	hihdr_gtm_lut_set_reg(module_desc, DPU_HDR_GTM_PQ2SLF_COEF_ADDR(hdr_base, 0),
	GTM_LUT_PQ2SLF_SIZE / 2,
	hdr_info->gtm_info.lut_pq2slf);
	hihdr_gtm_lut_set_reg(module_desc, DPU_HDR_GTM_LUMA0_LUT_ADDR(hdr_base, 0),
	GTM_LUT_LUMALUT0_SIZE / 2,
	hdr_info->gtm_info.lut_lumalut0);
	hihdr_gtm_lut_set_reg(
		module_desc, DPU_HDR_GTM_CHROMA_LUT_ADDR(hdr_base, 0),
		GTM_LUT_CHROMALUT0_SIZE / 2,
		hdr_info->gtm_info.lut_chromalut0); // Fixme: size = 16 not 256
	hihdr_gtm_lut_set_reg(module_desc, DPU_HDR_GTM_LUMA_LUT_ADDR(hdr_base, 0),
	GTM_LUT_LUMA_SIZE / 2, hdr_info->gtm_info.lut_luma);
	hihdr_gtm_lut_set_reg(
		module_desc, DPU_HDR_HDR_GTM_CHROMA_LUT_ADDR(hdr_base, 0),
		GTM_LUT_CHROMA_SIZE / 2, hdr_info->gtm_info.lut_chroma); // FIXME: size = 256 not 16
	hihdr_gtm_lut_set_reg(
		module_desc, DPU_HDR_GTM_CHROMA0_LUT_ADDR(hdr_base, 0),
		GTM_LUT_CHROMA0_SIZE / 2,
		hdr_info->gtm_info.lut_chroma0); // Fixme: size = 256 not 16
	hihdr_gtm_lut_set_reg(module_desc, DPU_HDR_GTM_CHROMA1_LUT_ADDR(hdr_base, 0),
	GTM_LUT_CHROMA1_SIZE / 2,
	hdr_info->gtm_info.lut_chroma1);
	hihdr_gtm_lut_set_reg(module_desc, DPU_HDR_GTM_CHROMA2_LUT_ADDR(hdr_base, 0),
	GTM_LUT_CHROMA2_SIZE / 2,
	hdr_info->gtm_info.lut_chroma2);
}

static void hihdr_gtm_set_basic_reg(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info) {
	int i = 0;

	if (hdr_info->flag == FLAG_BASIC) {
		disp_pr_debug(" +++++ ");

		hihdr_gtm_slf_lcproc_set_reg(module_desc, hdr_base, &(hdr_info->gtm_info));
		hihdr_gtm_slf_pq2slf_set_reg(module_desc, hdr_base, &(hdr_info->gtm_info));
		hihdr_gtm_lut_all_set_reg(module_desc, hdr_base, hdr_info);

		hdr_info->flag = FLAG_DEFAULT;
	}
}

static void hihdr_gtm_set_dynamic_reg(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info) {
	if (hdr_info->flag == FLAG_DYNAMIC) {
		hisi_module_set_reg(module_desc,
		DPU_HDR_GTM_SLF_LCPROC_MIN_E_ADDR(hdr_base),
		(hdr_info->gtm_info.output_min_e << 16 |
		hdr_info->gtm_info.input_min_e));

		hihdr_gtm_lut_all_set_reg(module_desc, hdr_base, hdr_info);

		hdr_info->flag = FLAG_DEFAULT;
	}
}

static void hihdr_gtm_set_stop_reg(struct dpu_module_desc *module_desc,
	char __iomem *hdr_base) {
	hisi_module_set_reg(module_desc, DPU_HDR_CTRL_ADDR(hdr_base), 0x0);
	hisi_module_set_reg(module_desc, DPU_HDR_GTM_CTRL_ADDR(hdr_base), 0x0);
}

void dpu_hihdr_gtm_set_reg(struct hisi_comp_operator *operator,
	struct dpu_module_desc *module_desc,
	struct pipeline_src_layer *src_layer,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info) {
	uint64_t width, height, size;
	width = operator->in_data->rect.w;
	height = operator->in_data->rect.h;
	size = 68719476736 / (width * height); // temp use
	disp_pr_debug(" +++++in[w h] = [0x%x 0x%x]", operator->in_data->rect.w,
		 operator->in_data->rect.h);

	hisi_module_set_reg(module_desc, DPU_HDR_SIZE_ADDR(hdr_base),
			((operator->in_data->rect.w - 1) << 16) |
		(operator->in_data->rect.h - 1));
	hisi_module_set_reg(module_desc, DPU_HDR_INV_SIZE_ADDR(hdr_base), size);

	switch (hdr_info->flag) {
	case FLAG_BASIC:
	hihdr_gtm_set_basic_reg(module_desc, hdr_base, hdr_info);
	break;
	case FLAG_DYNAMIC:
	hihdr_gtm_set_dynamic_reg(module_desc, hdr_base, hdr_info);
	break;
	case FLAG_STOP:
	hihdr_gtm_set_stop_reg(module_desc, hdr_base);
	break;
	default:
	break;
	}
}

void dpu_hdr_degamma_set_lut(struct dpu_module_desc *module_desc,
	struct pipeline_src_layer *src_layer,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info) {
	int cnt = 0;
	int j = 0;

	for (cnt = 0; cnt < IGM_LUT_LEN; cnt = cnt + 2) {
	if (hisi_hdr_display_effect_test & BIT(1)) {
		if (hisi_hdr_display_effect_test_color & BIT(0)) {
		dpu_set_reg(DPU_HDR_DEGAMMA_R_COEF_ADDR(hdr_base, j), hisi_effect_lut_r,
		12, 0);
		if (cnt != IGM_LUT_LEN - 1)
			dpu_set_reg(DPU_HDR_DEGAMMA_R_COEF_ADDR(hdr_base, j),
			hisi_effect_lut_r, 12, 16);
		}

		if (hisi_hdr_display_effect_test_color & BIT(1)) {
		dpu_set_reg(DPU_HDR_DEGAMMA_G_COEF_ADDR(hdr_base, j), hisi_effect_lut_g,
		12, 0);
		if (cnt != IGM_LUT_LEN - 1)
			dpu_set_reg(DPU_HDR_DEGAMMA_G_COEF_ADDR(hdr_base, j),
			hisi_effect_lut_g, 12, 16);
		}
		if (hisi_hdr_display_effect_test_color & BIT(2)) {
		dpu_set_reg(DPU_HDR_DEGAMMA_B_COEF_ADDR(hdr_base, j), hisi_effect_lut_b,
		12, 0);
		if (cnt != IGM_LUT_LEN - 1)
			dpu_set_reg(DPU_HDR_DEGAMMA_B_COEF_ADDR(hdr_base, j),
			hisi_effect_lut_b, 12, 16);
		}
		j++;
	} else {
		dpu_set_reg(DPU_HDR_DEGAMMA_R_COEF_ADDR(hdr_base, j),
		degama_lut_table_nolinear[cnt], 12, 0);
		if (cnt != IGM_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_DEGAMMA_R_COEF_ADDR(hdr_base, j),
		degama_lut_table_nolinear[cnt + 1], 12, 16);

		dpu_set_reg(DPU_HDR_DEGAMMA_G_COEF_ADDR(hdr_base, j),
		degama_lut_table_nolinear[cnt], 12, 0);
		if (cnt != IGM_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_DEGAMMA_G_COEF_ADDR(hdr_base, j),
		degama_lut_table_nolinear[cnt + 1], 12, 16);

		dpu_set_reg(DPU_HDR_DEGAMMA_B_COEF_ADDR(hdr_base, j),
		degama_lut_table_nolinear[cnt], 12, 0);
		if (cnt != IGM_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_DEGAMMA_B_COEF_ADDR(hdr_base, j),
		degama_lut_table_nolinear[cnt + 1], 12, 16);
		j++;
	}
	}
}
#define hdr_gmp_lut_addr(base, q) ((base) + (0x3000 + 0x4 * (q)))

void dpu_hdr_gmp_set_lut(struct dpu_module_desc *module_desc,
	struct pipeline_src_layer *src_layer,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info) {
	if (hisi_hdr_gmp_lut == 0) {
		int i;
		for (i = 0; i < GMP_COFE_CNT; i++) {
			dpu_set_reg(hdr_gmp_lut_addr(hdr_base, i * 2), gmp_lut_low[i], 32,
			0);
			dpu_set_reg(hdr_gmp_lut_addr(hdr_base, i * 2 + 1), gmp_lut_high[i],
			4, 0);
		}
	} else {
		int i;
		for (i = 0; i < GMP_COFE_CNT; i++) {
			dpu_set_reg(hdr_gmp_lut_addr(hdr_base, i * 2), gmp_lut_high[i], 32,
			0);
			dpu_set_reg(hdr_gmp_lut_addr(hdr_base, i * 2 + 1), gmp_lut_low[i],
			4, 0);
		}
	}
}

void dpu_hdr_gamma_set_lut(struct dpu_module_desc *module_desc,
	struct pipeline_src_layer *src_layer,
	char __iomem *hdr_base,
	struct dpu_hdr_info *hdr_info)

{
	int cnt = 0;
	int j = 0;

	for (cnt = 0; cnt < GAMMA_LUT_LEN; cnt = cnt + 2) {
	disp_pr_debug(" +++++ cnt = %d, j = %d", cnt, j);
	if (hisi_gamma_test_mode & BIT(1)) {
		dpu_set_reg(DPU_HDR_GAMMA_R_COEF_ADDR(hdr_base, j),
		gama_lut_table_linear[cnt], 12, 0);
		if (cnt != GAMMA_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_GAMMA_R_COEF_ADDR(hdr_base, j),
		gama_lut_table_linear[cnt + 1], 12, 16);

		dpu_set_reg(DPU_HDR_GAMMA_G_COEF_ADDR(hdr_base, j),
		gama_lut_table_linear[cnt], 12, 0);
		if (cnt != GAMMA_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_GAMMA_G_COEF_ADDR(hdr_base, j),
		gama_lut_table_linear[cnt + 1], 12, 16);

		dpu_set_reg(DPU_HDR_GAMMA_B_COEF_ADDR(hdr_base, j),
		gama_lut_table_linear[cnt], 12, 0);
		if (cnt != GAMMA_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_GAMMA_B_COEF_ADDR(hdr_base, j),
		gama_lut_table_linear[cnt + 1], 12, 16);
		j++;
	} else {
		dpu_set_reg(DPU_HDR_GAMMA_R_COEF_ADDR(hdr_base, j), hisi_gamma_lut_r, 12,
		0);
		if (cnt != GAMMA_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_GAMMA_R_COEF_ADDR(hdr_base, j), hisi_gamma_lut_r,
		12, 16);

		dpu_set_reg(DPU_HDR_GAMMA_G_COEF_ADDR(hdr_base, j), hisi_gamma_lut_g, 12,
		0);
		if (cnt != GAMMA_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_GAMMA_G_COEF_ADDR(hdr_base, j), hisi_gamma_lut_g,
		12, 16);

		dpu_set_reg(DPU_HDR_GAMMA_B_COEF_ADDR(hdr_base, j), hisi_gamma_lut_b, 12,
		0);
		if (cnt != GAMMA_LUT_LEN - 1)
		dpu_set_reg(DPU_HDR_GAMMA_B_COEF_ADDR(hdr_base, j), hisi_gamma_lut_b,
		12, 16);
		j++;
	}
	}
}
