/** @file
 * Copyright (c) 2020-2020, Hisilicon Tech. Co., Ltd. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 */

#include <linux/types.h>

#include "dpu_scf_lut.h"

#define PHASE_NUM 66
#define TAP4 4
#define TAP5 5
#define TAP6 6

const int g_coef_lut_v1_tap4[PHASE_NUM][TAP4] = {
	{214, 599, 214, -3},
	{207, 597, 223, -3},
	{200, 596, 231, -3},
	{193, 596, 238, -3},
	{186, 595, 246, -3},
	{178, 594, 255, -3},
	{171, 593, 263, -3},
	{165, 591, 271, -3},
	{158, 589, 279, -2},
	{151, 587, 288, -2},
	{145, 584, 296, -1},
	{139, 582, 304, -1},
	{133, 578, 312, 1},
	{127, 575, 321, 1},
	{121, 572, 329, 2},
	{115, 568, 337, 4},
	{109, 564, 346, 5},
	{104, 560, 354, 6},
	{ 98, 555, 362, 9},
	{ 94, 550, 370, 10},
	{ 88, 546, 379, 11},
	{ 84, 540, 387, 13},
	{ 79, 535, 395, 15},
	{ 74, 530, 403, 17},
	{ 70, 524, 411, 19},
	{ 66, 518, 419, 21},
	{ 62, 512, 427, 23},
	{ 57, 506, 435, 26},
	{ 54, 499, 443, 28},
	{ 50, 492, 451, 31},
	{ 47, 486, 457, 34},
	{ 43, 479, 465, 37},
	{ 40, 472, 472, 40},
	{214, 599, 214, -3},
	{207, 597, 223, -3},
	{200, 596, 231, -3},
	{193, 596, 238, -3},
	{186, 595, 246, -3},
	{178, 594, 255, -3},
	{171, 593, 263, -3},
	{165, 591, 271, -3},
	{158, 589, 279, -2},
	{151, 587, 288, -2},
	{145, 584, 296, -1},
	{139, 582, 304, -1},
	{133, 578, 312, 1},
	{127, 575, 321, 1},
	{121, 572, 329, 2},
	{115, 568, 337, 4},
	{109, 564, 346, 5},
	{104, 560, 354, 6},
	{ 98, 555, 362, 9},
	{ 94, 550, 370, 10},
	{ 88, 546, 379, 11},
	{ 84, 540, 387, 13},
	{ 79, 535, 395, 15},
	{ 74, 530, 403, 17},
	{ 70, 524, 411, 19},
	{ 66, 518, 419, 21},
	{ 62, 512, 427, 23},
	{ 57, 506, 435, 26},
	{ 54, 499, 443, 28},
	{ 50, 492, 451, 31},
	{ 47, 486, 457, 34},
	{ 43, 479, 465, 37},
	{ 40, 472, 472, 40}
};

const int g_coef_lut_v1_tap5[PHASE_NUM][TAP5] = {
	{ -94, 608, 608, -94, -4},
	{ -94, 594, 619, -91, -4},
	{ -96, 579, 635, -89, -5},
	{ -96, 563, 650, -87, -6},
	{ -97, 548, 665, -85, -7},
	{ -97, 532, 678, -82, -7},
	{ -98, 516, 693, -79, -8},
	{ -97, 500, 705, -75, -9},
	{ -97, 484, 720, -72, -11},
	{ -97, 468, 733, -68, -12},
	{ -96, 452, 744, -63, -13},
	{ -95, 436, 755, -58, -14},
	{ -94, 419, 768, -53, -16},
	{ -93, 403, 779, -48, -17},
	{ -92, 387, 789, -42, -18},
	{ -90, 371, 799, -36, -20},
	{ -89, 355, 809, -29, -22},
	{ -87, 339, 817, -22, -23},
	{ -86, 324, 826, -15, -25},
	{ -84, 308, 835,  -8, -27},
	{ -82, 293, 842,   0, -29},
	{ -80, 277, 849,   9, -31},
	{ -78, 262, 855,  18, -33},
	{ -75, 247, 860,  27, -35},
	{ -73, 233, 865,  36, -37},
	{ -71, 218, 870,  46, -39},
	{ -69, 204, 874,  56, -41},
	{ -66, 190, 876,  67, -43},
	{ -64, 176, 879,  78, -45},
	{ -62, 163, 882,  89, -48},
	{ -59, 150, 883, 100, -50},
	{ -57, 137, 883, 112, -51},
	{ -55, 125, 884, 125, -55},
	{  98, 415, 415,  98, -2},
	{  95, 412, 418, 103, -4},
	{  91, 408, 422, 107, -4},
	{  87, 404, 426, 111, -4},
	{  84, 399, 430, 115, -4},
	{  80, 395, 434, 119, -4},
	{  76, 390, 438, 124, -4},
	{  73, 386, 440, 128, -3},
	{  70, 381, 444, 132, -3},
	{  66, 376, 448, 137, -3},
	{  63, 371, 451, 142, -3},
	{  60, 366, 455, 146, -3},
	{  57, 361, 457, 151, -2},
	{  54, 356, 460, 156, -2},
	{  51, 351, 463, 161, -2},
	{  49, 346, 465, 165, -1},
	{  46, 341, 468, 170, -1},
	{  43, 336, 470, 175, 0},
	{  41, 331, 472, 180, 0},
	{  38, 325, 474, 186, 1},
	{  36, 320, 476, 191, 1},
	{  34, 315, 477, 196, 2},
	{  32, 309, 479, 201, 3},
	{  29, 304, 481, 206, 4},
	{  27, 299, 481, 212, 5},
	{  26, 293, 482, 217, 6},
	{  24, 288, 484, 222, 6},
	{  22, 282, 484, 228, 8},
	{  20, 277, 485, 233, 9},
	{  19, 271, 485, 238, 11},
	{  17, 266, 485, 244, 12},
	{  16, 260, 485, 250, 13},
	{  14, 255, 486, 255, 14}
};

const int g_coef_lut_v1_tap6[PHASE_NUM][TAP6] = {
	{-187, 105, 1186, 105, -187, 2},
	{-182,  86, 1186, 124, -192, 2},
	{-176,  67, 1185, 143, -197, 2},
	{-170,  49, 1182, 163, -202, 2},
	{-166,  32, 1180, 184, -207, 1},
	{-160,  15, 1176, 204, -212, 1},
	{-155,  -2, 1171, 225, -216, 1},
	{-149, -18, 1166, 246, -221, 0},
	{-145, -34, 1160, 268, -225, 0},
	{-139, -49, 1153, 290, -230,  -1},
	{-134, -63, 1145, 312, -234,  -2},
	{-129, -78, 1137, 334, -238,  -2},
	{-124, -91, 1128, 357, -241,  -5},
	{-119, -104, 1118, 379, -245,  -5},
	{-114, -117, 1107, 402, -248,  -6},
	{-109, -129, 1096, 425, -251,  -8},
	{-104, -141, 1083, 448, -254,  -8},
	{-100, -152, 1071, 471, -257,  -9},
	{ -95, -162, 1057, 494, -259, -11},
	{ -90, -172, 1043, 517, -261, -13},
	{ -86, -181, 1028, 540, -263, -14},
	{ -82, -190, 1013, 563, -264, -16},
	{ -77, -199,  997, 586, -265, -18},
	{ -73, -207,  980, 609, -266, -19},
	{ -69, -214,  963, 632, -266, -22},
	{ -65, -221,  945, 655, -266, -24},
	{ -62, -227,  927, 678, -266, -26},
	{ -58, -233,  908, 700, -265, -28},
	{ -54, -238,  889, 722, -264, -31},
	{ -51, -243,  870, 744, -262, -34},
	{ -48, -247,  850, 766, -260, -37},
	{ -45, -251,  829, 787, -257, -39},
	{ -42, -255,  809, 809, -255, -42},
	{-187, 105, 1186, 105, -187, 2},
	{-182,  86, 1186, 124, -192, 2},
	{-176,  67, 1185, 143, -197, 2},
	{-170,  49, 1182, 163, -202, 2},
	{-166,  32, 1180, 184, -207, 1},
	{-160,  15, 1176, 204, -212, 1},
	{-155,  -2, 1171, 225, -216, 1},
	{-149, -18, 1166, 246, -221, 0},
	{-145, -34, 1160, 268, -225, 0},
	{-139, -49, 1153, 290, -230,  -1},
	{-134, -63, 1145, 312, -234,  -2},
	{-129, -78, 1137, 334, -238,  -2},
	{-124, -91, 1128, 357, -241,  -5},
	{-119, -104, 1118, 379, -245,  -5},
	{-114, -117, 1107, 402, -248,  -6},
	{-109, -129, 1096, 425, -251,  -8},
	{-104, -141, 1083, 448, -254,  -8},
	{-100, -152, 1071, 471, -257,  -9},
	{ -95, -162, 1057, 494, -259, -11},
	{ -90, -172, 1043, 517, -261, -13},
	{ -86, -181, 1028, 540, -263, -14},
	{ -82, -190, 1013, 563, -264, -16},
	{ -77, -199,  997, 586, -265, -18},
	{ -73, -207,  980, 609, -266, -19},
	{ -69, -214,  963, 632, -266, -22},
	{ -65, -221,  945, 655, -266, -24},
	{ -62, -227,  927, 678, -266, -26},
	{ -58, -233,  908, 700, -265, -28},
	{ -54, -238,  889, 722, -264, -31},
	{ -51, -243,  870, 744, -262, -34},
	{ -48, -247,  850, 766, -260, -37},
	{ -45, -251,  829, 787, -257, -39},
	{ -42, -255,  809, 809, -255, -42}
};

static void scf_lut_set_reg(struct dpu_module_desc *module, char __iomem *base, uint16_t col, const int coef[][col])
{
	uint16_t i;
	uint16_t j;
	uint16_t k;
	int groups[3] = {0};  /* set scaling factor */
	int offset;
	int valid_num;

	offset = (col == TAP4) ? 8 : 16;
	valid_num = (offset == 16) ? 3 : 2;

	for (i = 0; i < PHASE_NUM; i++) {
		for (j = 0; j < col; j += 2) {
			if ((col % 2) && (j == (col - 1)))
				groups[j / 2] = (coef[i][j] & 0xfff) | (0 << 16);
			else
				groups[j / 2] = (coef[i][j] & 0xfff) | (coef[i][j + 1] << 16);
		}

		for (k = 0; k < valid_num; k++) {
			hisi_module_set_reg(module, base + offset * i + k * 4, groups[k]);
			groups[k] = 0;
		}
	}
}

void dpu_scf_lut_set_cmd(struct dpu_module_desc *module, char __iomem *base)
{
	/* tap6 */
	scf_lut_set_reg(module, DPU_ARSR_V0_SCF_VIDEO_6TAP_COEF_ADDR(base, 0), TAP6, g_coef_lut_v1_tap6);

	/* tap5 */
	scf_lut_set_reg(module, DPU_ARSR_V0_SCF_VIDEO_5TAP_COEF_ADDR(base, 0), TAP5, g_coef_lut_v1_tap5);

	/* tap6 */
	scf_lut_set_reg(module, DPU_ARSR_V0_SCF_VIDEO_4TAP_COEF_ADDR(base, 0), TAP4, g_coef_lut_v1_tap4);
}



